<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Docente - RetoTech</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        .course-selector {
            background: white;
            border-radius: 15px;
            padding: 1rem;
            margin: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 100%;
        }

        .course-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .course-card:hover {
            border-color: #059669;
            box-shadow: 0 4px 15px rgba(5, 150, 105, 0.2);
        }

        .course-card.active {
            border-color: #059669;
            background: #f0fdf4;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
            padding: 0 0.5rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        /* Responsividad mejorada */
        @media (max-width: 1200px) {
            .course-selector {
                margin: 1rem 0.5rem;
                padding: 1.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 0.8rem;
            }
        }

        @media (max-width: 768px) {
            .course-selector {
                margin: 0.5rem;
                padding: 1rem;
                border-radius: 10px;
            }

            .course-card {
                padding: 0.8rem;
                border-radius: 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
                margin: 0.5rem 0;
                padding: 0 0.25rem;
            }

            .stat-card {
                padding: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .course-selector {
                margin: 0.25rem;
                padding: 0.8rem;
            }

            .course-card {
                padding: 0.6rem;
                margin: 0.25rem 0;
            }

            .stats-grid {
                padding: 0;
                margin: 0.25rem 0;
            }
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
        }

        /* Estilos base para contenedor de temas */
        .themes-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
        }

        /* Estilos para vista detallada del estudiante - Completamente responsivo */
        .student-detail-container {
            max-width: 100%;
            margin: 0;
            padding: 1rem;
        }

        .student-header-compact {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .student-header-compact:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .theme-answer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(50px, 1fr));
            gap: 6px;
            max-width: 100%;
        }

        .answer-bubble {
            background: #dcfce7;
            border: 2px solid #22c55e;
            border-radius: 6px;
            padding: 6px 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            min-height: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-size: 0.75rem;
        }

        .answer-bubble.incorrect {
            background: #fecaca;
            border-color: #ef4444;
        }

        .answer-bubble:hover {
            transform: scale(1.05);
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .theme-progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 15px;
        }

        .theme-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1s ease;
        }

        /* Responsividad por tama√±os de pantalla */
        @media (max-width: 1400px) {
            .student-detail-container {
                padding: 0.8rem;
            }
        }

        @media (max-width: 1200px) {
            .student-header-compact {
                padding: 1.2rem;
                border-radius: 14px;
            }

            .theme-answer-grid {
                grid-template-columns: repeat(auto-fit, minmax(45px, 1fr));
                gap: 5px;
            }
        }

        @media (max-width: 992px) {
            .student-detail-container {
                padding: 0.6rem;
            }

            .student-header-compact {
                padding: 1rem;
                margin-bottom: 1rem;
            }
        }

        @media (max-width: 768px) {
            .student-detail-container {
                padding: 0.4rem;
            }

            .student-header-compact {
                padding: 0.8rem;
                border-radius: 12px;
                margin-bottom: 0.8rem;
            }

            .theme-answer-grid {
                grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
                gap: 4px;
            }

            .answer-bubble {
                padding: 4px 2px;
                min-height: 35px;
                font-size: 0.7rem;
                border-radius: 4px;
            }
        }

        @media (max-width: 576px) {
            .student-detail-container {
                padding: 0.2rem;
            }

            .student-header-compact {
                padding: 0.6rem;
                margin-bottom: 0.6rem;
            }

            .theme-answer-grid {
                grid-template-columns: repeat(auto-fit, minmax(35px, 1fr));
                gap: 3px;
            }

            .answer-bubble {
                padding: 3px 1px;
                min-height: 30px;
                font-size: 0.65rem;
            }
        }

        @media (max-width: 480px) {
            .student-detail-container {
                padding: 0.1rem;
            }

            .student-header-compact {
                padding: 0.5rem;
                border-radius: 8px;
            }

            .theme-answer-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 2px;
            }

            .answer-bubble {
                padding: 2px;
                min-height: 28px;
                font-size: 0.6rem;
            }
        }

        .student-detail-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .answer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .answer-item {
            padding: 1rem;
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .answer-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .answer-correct {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            border-color: #22c55e;
        }

        .answer-incorrect {
            background: linear-gradient(135deg, #fef2f2, #fecaca);
            border-color: #ef4444;
        }

        .student-table {
            border-radius: 8px;
            overflow: hidden;
        }

        .theme-stat-card {
            background: #667eea;
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 5px;
            text-align: center;
        }

        .theme-stat-number {
            font-size: 1.8rem;
            font-weight: bold;
        }

        .theme-stat-label {
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .question-detail-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #3b82f6;
        }

        .correct-answer {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .student-answer {
            padding: 0.5rem 1rem;
            border-radius: 25px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .student-answer.correct {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .student-answer.incorrect {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .theme-performance {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.08);
            border-top: 4px solid #3b82f6;
        }

        .performance-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
        }

        .performance-excellent {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .performance-good {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .performance-poor {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .back-btn {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 0.75rem 1.5rem;
            font-weight: bold;
            cursor: pointer;
            margin: 1rem 0;
        }

        .view-detail-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            cursor: pointer;
        }

        /* Estilos para controlar el crecimiento del contenido */
        #studentAnswers {
            max-height: 75vh !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            padding-right: 15px;
            position: relative;
        }

        .question-detail-card {
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            background: white;
            max-width: 100%;
            box-sizing: border-box;
        }

        .theme-performance {
            margin-bottom: 1.5rem !important;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem !important;
            background: white;
            max-height: 60vh !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            position: relative;
        }

        /* Contenedor principal del detalle del estudiante */
        #studentDetail {
            max-height: 90vh !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
        }

        /* Evitar que el contenido se desborde */
        .container-fluid {
            overflow-x: hidden !important;
            max-width: 100vw !important;
        }

        /* Limitar el ancho de las opciones para evitar desbordamiento horizontal */
        .question-detail-card .col-md-8,
        .question-detail-card .col-md-4 {
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            max-width: 100% !important;
            overflow: hidden !important;
        }

        /* Controlar el contenido de las preguntas */
        .question-detail-card h6,
        .question-detail-card small,
        .question-detail-card span {
            word-break: break-word !important;
            overflow-wrap: break-word !important;
        }

        /* Limitar altura m√°xima de cada secci√≥n de tema */
        .theme-performance>div:not(.d-flex) {
            max-height: 50vh !important;
            overflow-y: auto !important;
        }

        /* Estilos para las respuestas compactas */
        .answers-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
        }

        .answer-item-compact {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            white-space: nowrap;
            border: 1px solid transparent;
        }

        .answer-item-compact.correct {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .answer-item-compact.incorrect {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .answer-letter {
            font-weight: bold;
            font-family: monospace;
        }
    </style>
</head>

<body>
    <!-- Navegaci√≥n -->
    <div class="container-fluid">
        <nav class="navbar bg-dark border-bottom border-body" data-bs-theme="dark">
            <div class="container">
                <a class="navbar-brand" href="#">üë®‚Äçüè´ RetoTech - Docente</a>
                <div class="d-flex align-items-center">
                    <span class="user-info me-3">üëã <span id="currentTeacherName"></span></span>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showCourseSelector()">Cursos</a>
                        </li>
                        <li class="nav-item">
                            <button class="btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <div class="container">
        <!-- Selector de Cursos -->
        <div class="course-selector" id="courseSelector">
            <h2 class="text-center mb-4">üìö Selecciona un Curso para Ver Estad√≠sticas</h2>
            <div id="coursesList">
                <div class="text-center">
                    <div class="spinner-border text-success" role="status">
                        <span class="visually-hidden">Cargando cursos...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas del Curso -->
        <div id="courseStats" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-gradient rounded"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <div>
                    <h2 id="courseTitle" class="mb-1">üìä Estad√≠sticas del Curso</h2>
                    <small class="opacity-75">An√°lisis completo del rendimiento estudiantil</small>
                </div>
                <button class="btn btn-light" onclick="showCourseSelector()">
                    <i class="fas fa-arrow-left me-2"></i>Volver a Cursos
                </button>
            </div>

            <!-- Estad√≠sticas Generales -->
            <div class="stats-grid" id="generalStats"></div>

            <!-- Rendimiento por Tema - Nuevo Dise√±o -->
            <div class="mt-4">
                <div class="modern-performance-section" style="
                    background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
                    border: none;
                    border-radius: 20px;
                    padding: 25px;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                    position: relative;
                    overflow: hidden;
                ">
                    <div class="section-header" style="
                        display: flex;
                        align-items: center;
                        gap: 15px;
                        margin-bottom: 25px;
                        padding-bottom: 15px;
                        border-bottom: 2px solid #e2e8f0;
                    ">
                        <div style="
                            width: 60px;
                            height: 60px;
                            border-radius: 18px;
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 1.8rem;
                            color: white;
                        ">
                            üìä
                        </div>
                        <div>
                            <h4 style="margin: 0; color: #1e293b; font-size: 1.6rem; font-weight: 700;">Rendimiento
                                Detallado por Tema</h4>
                            <p style="margin: 0; color: #64748b; font-size: 1rem;">An√°lisis completo del desempe√±o
                                estudiantil</p>
                        </div>
                    </div>

                    <div id="themeStatsModern" class="themes-container"></div>

                    <!-- Gr√°fico comparativo mejorado -->
                    <div class="chart-section" style="
                        margin-top: 30px;
                        padding: 20px;
                        background: linear-gradient(135deg, #f8fafc, #e2e8f0);
                        border-radius: 15px;
                        border: 1px solid #cbd5e1;
                    ">
                        <h5 style="
                            text-align: center;
                            color: #1e293b;
                            margin-bottom: 20px;
                            font-weight: 700;
                        ">üìà Gr√°fico Comparativo de Rendimiento</h5>
                        <div style="height: 250px; position: relative;">
                            <canvas id="themeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Lista de Estudiantes - Nuevo Dise√±o -->
            <div class="mt-4">
                <div class="modern-students-section" style="
                    background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
                    border: none;
                    border-radius: 20px;
                    padding: 25px;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                    position: relative;
                    overflow: hidden;
                ">
                    <div class="section-header" style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 25px;
                        padding-bottom: 15px;
                        border-bottom: 2px solid #e2e8f0;
                    ">
                        <div style="
                            display: flex;
                            align-items: center;
                            gap: 15px;
                        ">
                            <div style="
                                width: 60px;
                                height: 60px;
                                border-radius: 18px;
                                background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 1.8rem;
                                color: white;
                            ">
                                üë•
                            </div>
                            <div>
                                <h4 style="margin: 0; color: #1e293b; font-size: 1.6rem; font-weight: 700;">Estudiantes
                                    del Curso</h4>
                                <p style="margin: 0; color: #64748b; font-size: 1rem;">Gesti√≥n y seguimiento individual
                                </p>
                            </div>
                        </div>
                        <div id="studentsCounter" style="
                            background: linear-gradient(135deg, #10b981, #059669);
                            color: white;
                            padding: 8px 16px;
                            border-radius: 12px;
                            font-weight: 700;
                            font-size: 0.9rem;
                        ">
                            0 Estudiantes
                        </div>
                    </div>

                    <div id="studentsList"></div>
                </div>
            </div>
        </div>

        <!-- Detalle del Estudiante -->
        <div id="studentDetail" style="display: none;">
            <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-gradient rounded"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                <div>
                    <h2 id="studentTitle" class="mb-1">üë§ Detalle del Estudiante</h2>
                    <small class="opacity-75">An√°lisis completo de respuestas y rendimiento</small>
                </div>
                <button class="btn btn-light" onclick="goBackToStats()">
                    <i class="fas fa-arrow-left me-2"></i>Volver a Estad√≠sticas
                </button>
            </div>

            <div class="student-detail-card">
                <div id="studentInfo"></div>
                <div id="studentAnswers"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Preguntas del quiz para referencia del docente
        const allQuestions = {
            'HTML': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© significa HTML?', options: ['A) Hyper Transfer Machine Language', 'B) HyperText Markup Language', 'C) HighText Machine Language', 'D) HyperTool Manual Language'], correct: 'B' },
                { question: '¬øQu√© etiqueta indica el inicio del documento?', options: ['A) <head>', 'B) <!DOCTYPE html>', 'C) <html>', 'D) <body>'], correct: 'B' },
                { question: '¬øQu√© etiqueta se usa para insertar una imagen?', options: ['A) <image>', 'B) <img>', 'C) <src>', 'D) <picture>'], correct: 'B' },
                { question: '¬øCu√°l es la funci√≥n del atributo alt en una imagen?', options: ['A) Cambiar el tama√±o', 'B) Texto alternativo', 'C) Agregar un enlace', 'D) Definir el formato'], correct: 'B' },
                { question: '¬øQu√© etiqueta se usa para crear listas ordenadas?', options: ['A) <ol>', 'B) <ul>', 'C) <li>', 'D) <list>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para crear un enlace?', options: ['A) <a>', 'B) <link>', 'C) <href>', 'D) <url>'], correct: 'A' },
                { question: '¬øQu√© atributo abre un enlace en una nueva pesta√±a?', options: ['A) open="_blank"', 'B) target="_blank"', 'C) href="_blank"', 'D) window="new"'], correct: 'B' },
                { question: '¬øQu√© etiqueta define el encabezado principal?', options: ['A) <header>', 'B) <head>', 'C) <hgroup>', 'D) <h1>'], correct: 'A' },
                { question: '¬øCu√°l es la diferencia entre <div> y <span>?', options: ['A) div bloque / span l√≠nea', 'B) div l√≠nea / span bloque', 'C) no hay diferencia', 'D) div es obsoleto'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para formularios?', options: ['A) <form>', 'B) <input>', 'C) <section>', 'D) <field>'], correct: 'A' },

                // INTERMEDIO (11-20)
                { question: '¬øQu√© atributo de <input> define el tipo de dato?', options: ['A) value', 'B) type', 'C) data', 'D) kind'], correct: 'B' },
                { question: '¬øQu√© etiqueta agrupa opciones en un men√∫ desplegable?', options: ['A) <group>', 'B) <option>', 'C) <select>', 'D) <dropdown>'], correct: 'C' },
                { question: '¬øQu√© etiqueta define el pie de p√°gina?', options: ['A) <footer>', 'B) <bottom>', 'C) <end>', 'D) <base>'], correct: 'A' },
                { question: '¬øQu√© etiqueta define una celda de encabezado en una tabla?', options: ['A) <th>', 'B) <td>', 'C) <tr>', 'D) <thead>'], correct: 'A' },
                { question: '¬øQu√© etiqueta agrupa el contenido principal?', options: ['A) <main>', 'B) <body>', 'C) <article>', 'D) <content>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para t√≠tulos de distintos niveles?', options: ['A) <h1> - <h6>', 'B) <p>', 'C) <title>', 'D) <heading>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para separar secciones tem√°ticas?', options: ['A) <section>', 'B) <div>', 'C) <area>', 'D) <part>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para incluir un script externo?', options: ['A) <script src="">', 'B) <code>', 'C) <import>', 'D) <js>'], correct: 'A' },
                { question: '¬øQu√© atributo define el texto que aparece al pasar el cursor?', options: ['A) alt', 'B) title', 'C) tooltip', 'D) hint'], correct: 'B' },
                { question: '¬øQu√© etiqueta permite insertar audio en una p√°gina web?', options: ['A) <sound>', 'B) <audio>', 'C) <music>', 'D) <media>'], correct: 'B' },

                // AVANZADO (21-30)
                { question: '¬øQu√© etiqueta define contenido independiente, como una noticia?', options: ['A) <article>', 'B) <section>', 'C) <div>', 'D) <content>'], correct: 'A' },
                { question: '¬øQu√© atributo se usa para identificar un elemento √∫nico?', options: ['A) class', 'B) id', 'C) key', 'D) name'], correct: 'B' },
                { question: '¬øQu√© etiqueta agrupa navegaci√≥n principal?', options: ['A) <nav>', 'B) <menu>', 'C) <path>', 'D) <navigation>'], correct: 'A' },
                { question: '¬øQu√© atributo muestra texto en un campo antes de escribir?', options: ['A) hint', 'B) value', 'C) placeholder', 'D) default'], correct: 'C' },
                { question: '¬øQu√© etiqueta representa contenido destacado visualmente?', options: ['A) <strong>', 'B) <mark>', 'C) <highlight>', 'D) <em>'], correct: 'B' },
                { question: '¬øQu√© etiqueta define una lista de definiciones?', options: ['A) <dl>', 'B) <ol>', 'C) <ul>', 'D) <def>'], correct: 'A' },
                { question: '¬øQu√© atributo en <img> define el texto alternativo?', options: ['A) src', 'B) alt', 'C) title', 'D) desc'], correct: 'B' },
                { question: '¬øQu√© etiqueta se usa para contenido externo como videos?', options: ['A) <iframe>', 'B) <video>', 'C) <embed>', 'D) <external>'], correct: 'A' },
                { question: '¬øQu√© atributo permite ejecutar una funci√≥n al hacer clic?', options: ['A) onclick', 'B) action', 'C) onpress', 'D) click'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para definir una lista desplegable?', options: ['A) <select>', 'B) <input>', 'C) <options>', 'D) <dropdown>'], correct: 'A' }
            ],
            'CSS': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© significa CSS?', options: ['A) Cascading Style Sheets', 'B) Color Style Syntax', 'C) Computer Style Syntax', 'D) Creative Style System'], correct: 'A' },
                { question: '¬øQu√© propiedad cambia el color del texto?', options: ['A) font-color', 'B) text-color', 'C) color', 'D) text'], correct: 'C' },
                { question: '¬øQu√© propiedad cambia el color de fondo?', options: ['A) background-color', 'B) fill', 'C) bg-color', 'D) color-bg'], correct: 'A' },
                { question: '¬øQu√© propiedad alinea texto al centro?', options: ['A) text-align: center', 'B) center-text', 'C) align-center', 'D) text-center'], correct: 'A' },
                { question: '¬øQu√© propiedad controla el tama√±o del texto?', options: ['A) font-size', 'B) text-size', 'C) size', 'D) font'], correct: 'A' },
                { question: '¬øQu√© diferencia hay entre margin y padding?', options: ['A) margin externo / padding interno', 'B) margin interno / padding externo', 'C) no hay diferencia', 'D) ambos son externos'], correct: 'A' },
                { question: '¬øQu√© propiedad cambia el tipo de letra?', options: ['A) font-family', 'B) text-font', 'C) font-name', 'D) typeface'], correct: 'A' },
                { question: '¬øQu√© propiedad redondea las esquinas de un elemento?', options: ['A) border-radius', 'B) corner', 'C) round', 'D) curve'], correct: 'A' },
                { question: '¬øQu√© propiedad agrega una sombra a un elemento?', options: ['A) box-shadow', 'B) shadow', 'C) border-shadow', 'D) drop-shadow'], correct: 'A' },
                { question: '¬øQu√© propiedad controla la altura de l√≠nea de texto?', options: ['A) line-height', 'B) height-line', 'C) spacing', 'D) line-space'], correct: 'A' },

                // INTERMEDIO (11-20)
                { question: '¬øQu√© hace display:flex?', options: ['A) Mueve el texto', 'B) Crea una estructura flexible', 'C) Alinea im√°genes', 'D) Oculta elementos'], correct: 'B' },
                { question: '¬øQu√© propiedad distribuye espacio horizontal en Flexbox?', options: ['A) justify-content', 'B) align-items', 'C) space-between', 'D) flex-space'], correct: 'A' },
                { question: '¬øQu√© hace la propiedad transition?', options: ['A) A√±ade animaci√≥n suave', 'B) Cambia el color', 'C) Activa clic', 'D) Mueve elementos'], correct: 'A' },
                { question: '¬øQu√© propiedad controla el espaciado entre letras?', options: ['A) letter-spacing', 'B) word-spacing', 'C) text-space', 'D) char-spacing'], correct: 'A' },
                { question: '¬øQu√© propiedad controla la posici√≥n de un elemento?', options: ['A) position', 'B) placement', 'C) align', 'D) location'], correct: 'A' },
                { question: '¬øQu√© valor posiciona un elemento respecto al contenedor?', options: ['A) relative', 'B) absolute', 'C) static', 'D) fixed'], correct: 'B' },
                { question: '¬øQu√© valor coloca elementos uno al lado del otro?', options: ['A) inline-block', 'B) grid', 'C) float', 'D) flex'], correct: 'A' },
                { question: '¬øQu√© unidad mide el tama√±o relativo a la ra√≠z?', options: ['A) em', 'B) px', 'C) rem', 'D) vh'], correct: 'C' },
                { question: '¬øQu√© propiedad controla el orden de apilamiento?', options: ['A) z-index', 'B) stack', 'C) priority', 'D) layer'], correct: 'A' },
                { question: '¬øQu√© propiedad controla la opacidad de un elemento?', options: ['A) opacity', 'B) visibility', 'C) blur', 'D) transparent'], correct: 'A' },

                // AVANZADO (21-30)
                { question: '¬øQu√© define una animaci√≥n en CSS?', options: ['A) @animation', 'B) @keyframes', 'C) @frameset', 'D) @animate'], correct: 'B' },
                { question: '¬øQu√© propiedad inicia una animaci√≥n?', options: ['A) animate', 'B) animation-name', 'C) key-name', 'D) start-animation'], correct: 'B' },
                { question: '¬øQu√© propiedad define la duraci√≥n de una animaci√≥n?', options: ['A) time', 'B) animation-duration', 'C) duration', 'D) length'], correct: 'B' },
                { question: '¬øQu√© propiedad hace un contenedor con filas y columnas?', options: ['A) display:grid', 'B) display:block', 'C) display:flex', 'D) display:table'], correct: 'A' },
                { question: '¬øQu√© propiedad crea una cuadr√≠cula de 3 columnas?', options: ['A) grid-template-columns: repeat(3, 1fr)', 'B) grid-columns: 3', 'C) columns: grid(3)', 'D) grid: 3'], correct: 'A' },
                { question: '¬øQu√© propiedad define espaciado entre filas en Grid?', options: ['A) grid-row-gap', 'B) row-gap', 'C) gap', 'D) spacing'], correct: 'C' },
                { question: '¬øQu√© propiedad permite cambio suave de estilo?', options: ['A) transition', 'B) ease', 'C) effect', 'D) smooth'], correct: 'A' },
                { question: '¬øQu√© propiedad hace que un elemento sea fijo en pantalla?', options: ['A) position:fixed', 'B) display:block', 'C) float:right', 'D) sticky'], correct: 'A' },
                { question: '¬øQu√© propiedad alinea elementos verticalmente en Flexbox?', options: ['A) align-items', 'B) justify-content', 'C) align-self', 'D) vertical-align'], correct: 'A' },
                { question: '¬øQu√© propiedad define el color de un borde?', options: ['A) border-color', 'B) outline', 'C) frame', 'D) edge-color'], correct: 'A' }
            ],
            'Condicionales': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© palabra clave inicia una estructura condicional?', options: ['A) if', 'B) when', 'C) choose', 'D) select'], correct: 'A' },
                { question: '¬øQu√© palabra clave se usa cuando la condici√≥n no se cumple?', options: ['A) next', 'B) else', 'C) or', 'D) otherwise'], correct: 'B' },
                { question: '¬øQu√© operador se utiliza para comparar igualdad?', options: ['A) ==', 'B) =', 'C) ===', 'D) equals'], correct: 'A' },
                { question: '¬øQu√© operador l√≥gico representa el "Y" l√≥gico?', options: ['A) &&', 'B) ||', 'C) !=', 'D) AND'], correct: 'A' },
                { question: '¬øQu√© valor se considera falso sin compararlo?', options: ['A) 1', 'B) 0', 'C) "texto"', 'D) true'], correct: 'B' },
                { question: '¬øQu√© operador invierte el valor l√≥gico de una condici√≥n?', options: ['A) &&', 'B) ||', 'C) !', 'D) NOT'], correct: 'C' },
                { question: '¬øQu√© palabra eval√∫a m√°s de una condici√≥n?', options: ['A) else if / elif', 'B) case', 'C) for', 'D) switch'], correct: 'A' },
                { question: '¬øQu√© significa "evaluaci√≥n de cortocircuito"?', options: ['A) Se eval√∫a solo una vez', 'B) El resultado se detiene si ya se conoce', 'C) Ejecuta sin evaluar', 'D) Reinicia la evaluaci√≥n'], correct: 'B' },
                { question: '¬øQu√© operador ternario se usa en muchos lenguajes?', options: ['A) ?:', 'B) ??', 'C) %%', 'D) ::'], correct: 'A' },
                { question: '¬øQu√© pasa si ninguna condici√≥n se cumple?', options: ['A) El programa se detiene', 'B) Se ejecuta el bloque else', 'C) Se reinicia la condici√≥n', 'D) Error de sintaxis'], correct: 'B' },

                // INTERMEDIO (11-20)
                { question: '¬øQu√© estructura permite ejecutar distintos bloques seg√∫n condici√≥n?', options: ['A) if - else', 'B) while - for', 'C) do - while', 'D) loop'], correct: 'A' },
                { question: '¬øQu√© palabra se usa para encadenar condiciones adicionales?', options: ['A) elseif / elif', 'B) also', 'C) continue', 'D) then'], correct: 'A' },
                { question: '¬øQu√© estructura reemplaza varios if en casos conocidos?', options: ['A) switch', 'B) repeat', 'C) loop', 'D) match'], correct: 'A' },
                { question: '¬øQu√© hace este c√≥digo? if (x > 10 && x < 20)', options: ['A) Eval√∫a si x est√° entre 10 y 20', 'B) Eval√∫a si x es mayor que 20', 'C) Eval√∫a si x es menor que 10', 'D) Da error'], correct: 'A' },
                { question: 'if (false) {print("Hola")} else {print("Adi√≥s")} ¬øQu√© imprime?', options: ['A) Hola', 'B) Adi√≥s', 'C) Nada', 'D) Error'], correct: 'B' },
                { question: '¬øQu√© estructura es m√°s eficiente para rangos fijos?', options: ['A) switch', 'B) for', 'C) while', 'D) if anidado'], correct: 'A' },
                { question: '¬øQu√© palabra define una condici√≥n dentro de otra?', options: ['A) if anidado', 'B) condici√≥n doble', 'C) condici√≥n recursiva', 'D) if compuesto'], correct: 'A' },
                { question: '¬øQu√© operador l√≥gico representa el "O" l√≥gico?', options: ['A) &&', 'B) ||', 'C) !!', 'D) OR'], correct: 'B' },
                { question: '¬øCu√°l de los siguientes es un operador de comparaci√≥n?', options: ['A) >=', 'B) &&', 'C) or', 'D) ='], correct: 'A' },
                { question: '¬øQu√© tipo de estructura utiliza el operador ternario?', options: ['A) Condicional compacta', 'B) Bucle simple', 'C) Estructura repetitiva', 'D) Funci√≥n'], correct: 'A' },

                // AVANZADO (21-30)
                { question: 'x = 5; if x == 5: print("ok") else: print("no"). ¬øQu√© imprime?', options: ['A) ok', 'B) no', 'C) error', 'D) nada'], correct: 'A' },
                { question: 'En JavaScript, ¬øqu√© valor devuelve (5 > 2) && (3 < 1)?', options: ['A) true', 'B) false', 'C) undefined', 'D) null'], correct: 'B' },
                { question: '¬øQu√© ocurre si colocas un if dentro de un else?', options: ['A) Se eval√∫an ambos a la vez', 'B) Se crea una estructura anidada', 'C) Genera error de sintaxis', 'D) Solo ejecuta el else'], correct: 'B' },
                { question: '¬øQu√© tipo de valores pueden evaluarse en una condici√≥n?', options: ['A) Solo n√∫meros', 'B) Cualquier valor booleano', 'C) Solo texto', 'D) Solo variables'], correct: 'B' },
                { question: 'En el c√≥digo if (x != 10), ¬øqu√© significa "!="?', options: ['A) es igual', 'B) es diferente', 'C) es mayor', 'D) es menor'], correct: 'B' },
                { question: '¬øCu√°l es el resultado de if (false || true)?', options: ['A) true', 'B) false', 'C) error', 'D) undefined'], correct: 'A' },
                { question: '¬øQu√© significa este condicional?: if (!tienePermiso)', options: ['A) Si tiene permiso', 'B) Si no tiene permiso', 'C) Si permiso es undefined', 'D) Error de sintaxis'], correct: 'B' },
                { question: '¬øQu√© palabra clave finaliza un bloque if en Python?', options: ['A) endif', 'B) :', 'C) end', 'D) }'], correct: 'B' },
                { question: '¬øQu√© operador combina varias condiciones con prioridad?', options: ['A) ()', 'B) {}', 'C) []', 'D) <>'], correct: 'A' },
                { question: '¬øQu√© significa else if en un flujo de control?', options: ['A) Condici√≥n adicional', 'B) Condici√≥n final', 'C) Condici√≥n vac√≠a', 'D) Repetici√≥n'], correct: 'A' }
            ],
            'While': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© hace un bucle while?', options: ['A) Ejecuta c√≥digo solo una vez', 'B) Repite mientras la condici√≥n sea verdadera', 'C) Compara dos valores y termina', 'D) Cuenta hasta 10'], correct: 'B' },
                { question: '¬øQu√© tipo de valor eval√∫a la condici√≥n de un while?', options: ['A) Num√©rico', 'B) Booleano', 'C) Texto', 'D) Array'], correct: 'B' },
                { question: '¬øQu√© ocurre si la condici√≥n nunca cambia a false?', options: ['A) Se ejecuta una vez', 'B) Se crea un bucle infinito', 'C) Se fuerza un error', 'D) Se detiene solo'], correct: 'B' },
                { question: '¬øQu√© palabra clave detiene el bucle inmediatamente?', options: ['A) stop', 'B) exit', 'C) break', 'D) end'], correct: 'C' },
                { question: '¬øQu√© palabra clave salta a la siguiente iteraci√≥n?', options: ['A) continue', 'B) skip', 'C) next', 'D) pass'], correct: 'A' },
                { question: 'Si la condici√≥n es false al inicio, el while...', options: ['A) No se ejecuta', 'B) Se ejecuta una vez', 'C) Se ejecuta dos veces', 'D) Da error'], correct: 'A' },
                { question: '¬øQu√© se suele usar para contar iteraciones en un while?', options: ['A) Un acumulador', 'B) Un contador', 'C) Un comparador', 'D) Un √≠ndice'], correct: 'B' },
                { question: 'Para evitar bucles infinitos es importante...', options: ['A) No modificar variables', 'B) Modificar la variable de control apropiadamente', 'C) Usar siempre break', 'D) No usar condiciones'], correct: 'B' },
                { question: 'i=1; while(i<=3){print(i); i++} ¬øQu√© imprime?', options: ['A) 1 2 3', 'B) 0 1 2', 'C) 2 3 4', 'D) Error'], correct: 'A' },
                { question: '¬øQu√© instrucci√≥n para un men√∫ que se repite hasta "Salir"?', options: ['A) while (opcion != "Salir")', 'B) for (siempre)', 'C) switch (Salir)', 'D) if (Salir)'], correct: 'A' },

                // INTERMEDIO (11-20)
                { question: 'i=0; while(i<5){ i=i+2 } ¬øQu√© hace?', options: ['A) Itera 3 veces (0,2,4)', 'B) Itera 2 veces (0,2)', 'C) Nunca entra al bucle', 'D) Bucle infinito'], correct: 'A' },
                { question: '¬øCu√°l es el problema? while(i<10){ print(i) }', options: ['A) Falta incrementar i; puede ser infinito', 'B) No se puede imprimir en while', 'C) La condici√≥n debe ser i<=10', 'D) No hay problema'], correct: 'A' },
                { question: 'Patr√≥n correcto para sumar 1..n con while', options: ['A) i=1; suma=0; while(i<=n){ suma+=i; i++ }', 'B) i=0; suma=0; mientras(n){ suma+=n }', 'C) i=1; suma=0; while(i<n){ suma=i }', 'D) suma=0; while(true){ suma++ }'], correct: 'A' },
                { question: '¬øQu√© hace continue dentro de un while?', options: ['A) Termina el bucle', 'B) Salta el resto y pasa a la siguiente vuelta', 'C) Reinicia las variables', 'D) Pausa el bucle'], correct: 'B' },
                { question: 'Mejor forma de leer n√∫meros hasta ingresar 0', options: ['A) while(num != 0){ leer num; acumular }', 'B) while(true){ acumular }', 'C) for(num!=0){ leer num }', 'D) if(num==0){ leer }'], correct: 'A' },
                { question: 'i=0; while(i<3){ i++; } print(i) ¬øQu√© imprime?', options: ['A) 0', 'B) 2', 'C) 3', 'D) Error'], correct: 'C' },
                { question: 'Para validar entrada hasta que sea v√°lida se usa...', options: ['A) Un while con condici√≥n sobre la validez', 'B) Un for de 10 iteraciones', 'C) Un switch de opciones', 'D) Un if simple'], correct: 'A' },
                { question: '¬øQu√© ventaja tiene while sobre for?', options: ['A) Mejor cuando no se conoce el n√∫mero de repeticiones', 'B) Siempre es m√°s r√°pido', 'C) Permite anidar if', 'D) Es m√°s corto'], correct: 'A' },
                { question: 'i=1; while(i<=5){ if(i%2==0){print(i)}; i++ } ¬øQu√© imprime?', options: ['A) 1 3 5', 'B) 2 4', 'C) 2 3 4 5', 'D) Error'], correct: 'B' },
                { question: '¬øQu√© hace? while True: if intento==3: break', options: ['A) Nunca termina', 'B) Termina al tercer intento', 'C) Termina al primer intento', 'D) Error'], correct: 'B' },

                // AVANZADO (21-30)
                { question: 'Patr√≥n seguro para leer hasta palabra clave "salir"', options: ['A) while(palabra != "salir"){ leer palabra }', 'B) while("salir"){ leer palabra }', 'C) while(palabra == "salir"){ leer palabra }', 'D) for(palabra){ leer }'], correct: 'A' },
                { question: 'i=1; total=0; while(i<=4){ total+=i*i; i++ } print(total) ¬øImprime?', options: ['A) 10', 'B) 30', 'C) 20', 'D) 16'], correct: 'B' },
                { question: 'Para limitar un while a 100 iteraciones m√°ximo, usar√≠as...', options: ['A) Un contador de intentos y condici√≥n extra', 'B) Solo break sin condici√≥n', 'C) continue dentro de if', 'D) Un for'], correct: 'A' },
                { question: '¬øQu√© ocurre si pones break dentro de un if anidado en while?', options: ['A) Rompe todo el while', 'B) Solo salta a la siguiente iteraci√≥n', 'C) Reinicia el bucle', 'D) Error'], correct: 'A' },
                { question: 'Patr√≥n correcto para Fibonacci < 100', options: ['A) a=0;b=1; while(a<100){ print(a); a,b=b,a+b }', 'B) a=0; while(a<100){ a=a+a }', 'C) b=1; while(b<100){ print(b); b=b }', 'D) while(100){ print(a) }'], correct: 'A' },
                { question: '¬øQu√© hace? while(cond){ ...; if(error){ break } }', options: ['A) Finaliza el bucle si ocurre un error', 'B) Ignora los errores', 'C) Duplica las iteraciones', 'D) Contin√∫a siempre'], correct: 'A' },
                { question: 'Patr√≥n para "intentos de login" m√°x. 3', options: ['A) intentos=0; while(intentos<3 && !loginOk){ intentos++ }', 'B) while(loginOk){ pedir credenciales }', 'C) for(loginOk){ pedir credenciales }', 'D) if(intentos==3){ salir }'], correct: 'A' },
                { question: 'i=0; while(i<5){ i+=2; print(i) } ¬øQu√© imprime?', options: ['A) 1 2 3 4 5', 'B) 2 4', 'C) 2 4 6', 'D) 0 2 4'], correct: 'B' },
                { question: 'Para evitar consumir CPU en un while de espera activa...', options: ['A) Agregar una pausa (sleep)', 'B) Usar continue siempre', 'C) Incrementar dos veces el contador', 'D) Usar break'], correct: 'A' },
                { question: '¬øQu√© combinaci√≥n v√°lida para salir por m√∫ltiples condiciones?', options: ['A) Condici√≥n compuesta y/o break en casos especiales', 'B) Solo usar continue', 'C) Solo usar return', 'D) Solo usar exit'], correct: 'A' }
            ]
        };
    </script>
    <script>
        let currentTeacher = null;
        let authToken = null;
        let selectedCourse = null;
        let currentCourseStats = null;

        document.addEventListener('DOMContentLoaded', function () {
            initializeTeacherDashboard();
        });

        async function initializeTeacherDashboard() {
            // Verificar autenticaci√≥n
            authToken = localStorage.getItem('retotech_token');
            const userData = localStorage.getItem('retotech_user');

            if (!authToken || !userData) {
                window.location.href = 'login.html';
                return;
            }

            currentTeacher = JSON.parse(userData);

            // Verificar que sea docente
            if (currentTeacher.role !== 'docente') {
                alert('Acceso denegado. Solo docentes pueden acceder aqu√≠.');
                window.location.href = 'login.html';
                return;
            }

            // Actualizar UI
            document.getElementById('currentTeacherName').textContent = currentTeacher.username;

            // Cargar cursos disponibles
            await loadCourses();
        }

        async function loadCourses() {
            try {
                const response = await fetch('/api/teacher/courses', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const courses = await response.json();
                    displayCourses(courses);
                } else if (response.status === 401) {
                    logout();
                } else {
                    document.getElementById('coursesList').innerHTML =
                        '<div class="alert alert-warning">Error cargando cursos</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('coursesList').innerHTML =
                    '<div class="alert alert-danger">Error de conexi√≥n</div>';
            }
        }

        function displayCourses(courses) {
            const container = document.getElementById('coursesList');

            if (courses.length === 0) {
                container.innerHTML = `
                    <div class="alert alert-info text-center">
                        <h5>üìö No hay cursos con estudiantes registrados</h5>
                        <p>Los cursos aparecer√°n aqu√≠ cuando los estudiantes se registren.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = courses.map(course => `
                <div class="course-card" onclick="selectCourse('${course}')">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-1">üìñ ${course}</h5>
                            <p class="text-muted mb-0">Ver estad√≠sticas y rendimiento</p>
                        </div>
                        <div>
                            <span class="badge bg-success">Activo</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function selectCourse(course) {
            selectedCourse = course;

            // Mostrar loading
            document.getElementById('courseSelector').style.display = 'none';
            document.getElementById('courseStats').style.display = 'block';
            document.getElementById('courseTitle').textContent = `üìä Estad√≠sticas - ${course}`;

            try {
                const response = await fetch(`/api/teacher/course-stats/${encodeURIComponent(course)}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    currentCourseStats = stats;
                    displayCourseStats(stats);
                } else {
                    alert('Error cargando estad√≠sticas del curso');
                    showCourseSelector();
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexi√≥n');
                showCourseSelector();
            }
        }

        function displayCourseStats(stats) {
            // Estad√≠sticas generales
            const generalStats = document.getElementById('generalStats');
            const avgScore = Math.round(stats.general.promedio_aciertos || 0);

            generalStats.innerHTML = `
                <div class="stat-card" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white;">
                    <div class="stat-number">${stats.general.total_estudiantes || 0}</div>
                    <div>üë• Total Estudiantes</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669); color: white;">
                    <div class="stat-number">${stats.general.estudiantes_activos || 0}</div>
                    <div>üéØ Estudiantes Activos</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white;">
                    <div class="stat-number">${stats.general.total_respuestas || 0}</div>
                    <div>üìù Total Respuestas</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, ${avgScore >= 80 ? '#10b981, #059669' : avgScore >= 60 ? '#f59e0b, #d97706' : '#ef4444, #dc2626'}); color: white;">
                    <div class="stat-number">${avgScore}%</div>
                    <div>ÔøΩ Promedio General</div>
                </div>
            `;

            // Gr√°fico por temas
            drawThemeChart(stats.byTheme);

            // Lista de estudiantes
            displayStudentsList(stats.byStudent);
        }

        function drawThemeChart(themeStats) {
            // Nuevo dise√±o moderno para estad√≠sticas por tema
            const themeStatsContainer = document.getElementById('themeStatsModern');
            if (themeStatsContainer) {
                const themes = ['HTML', 'CSS', 'Condicionales', 'While'];
                const icons = ['üèóÔ∏è', 'üé®', 'üîÄ', 'üîÑ'];

                themeStatsContainer.innerHTML = themes.map((theme, index) => {
                    const stat = themeStats.find(s => s.tema === theme);
                    const accuracy = stat && stat.total_respuestas > 0 ?
                        Math.round((stat.respuestas_correctas / stat.total_respuestas) * 100) : 0;
                    const participantes = stat ? stat.estudiantes_participantes : 0;
                    const correctas = stat ? stat.respuestas_correctas : 0;
                    const total = stat ? stat.total_respuestas : 0;

                    // Funci√≥n para obtener color basado en accuracy
                    const getScoreColor = (score) => {
                        if (score >= 80) return '#10b981';  // Verde excelente
                        if (score >= 60) return '#f59e0b';  // Amarillo bueno
                        if (score >= 40) return '#f97316';  // Naranja regular
                        return '#ef4444';                   // Rojo necesita mejorar
                    };

                    return `
                        <div class="theme-performance-card-responsive" style="
                            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
                            border: 2px solid ${accuracy >= 70 ? '#22c55e' : accuracy >= 50 ? '#f59e0b' : '#ef4444'};
                            border-radius: 16px;
                            padding: 1.2rem;
                            margin-bottom: 1rem;
                            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
                            position: relative;
                            overflow: hidden;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 10px 35px rgba(0, 0, 0, 0.15)'"
                           onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 6px 24px rgba(0, 0, 0, 0.1)'">
                            
                            <!-- Header responsivo con estad√≠sticas principales -->
                            <div class="theme-header-responsive" style="
                                display: flex;
                                justify-content: space-between;
                                align-items: flex-start;
                                margin-bottom: 1rem;
                                padding-bottom: 0.8rem;
                                border-bottom: 2px solid #e2e8f0;
                                flex-wrap: wrap;
                                gap: 0.8rem;
                            ">
                                <div class="theme-title-responsive" style="
                                    display: flex;
                                    align-items: center;
                                    gap: 0.8rem;
                                    flex: 1;
                                    min-width: 200px;
                                ">
                                    <div class="theme-icon-responsive" style="
                                        width: 40px;
                                        height: 40px;
                                        border-radius: 10px;
                                        background: linear-gradient(135deg, ${getScoreColor(accuracy)}, ${getScoreColor(accuracy)}dd);
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        font-size: 1.2rem;
                                        color: white;
                                        transition: transform 0.3s ease;
                                        flex-shrink: 0;
                                    ">
                                        ${icons[index]}
                                    </div>
                                    <div style="flex: 1; min-width: 0;">
                                        <h5 class="theme-title-text" style="margin: 0; color: #1e293b; font-size: 1.1rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${theme}</h5>
                                        <p class="theme-subtitle-text" style="margin: 0; color: #64748b; font-size: 0.75rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${participantes} estudiante${participantes !== 1 ? 's' : ''} participante${participantes !== 1 ? 's' : ''}</p>
                                    </div>
                                </div>
                                
                                <div class="theme-metrics-responsive" style="
                                    display: flex;
                                    gap: 0.8rem;
                                    align-items: center;
                                    flex-wrap: wrap;
                                    justify-content: flex-end;
                                ">
                                    <div class="metric-responsive" style="text-align: center; min-width: 60px;">
                                        <div class="metric-value-responsive" style="font-size: 1.6rem; font-weight: 800; color: ${getScoreColor(accuracy)}; line-height: 1;">
                                            ${accuracy}%
                                        </div>
                                        <div class="metric-label-responsive" style="font-size: 0.65rem; color: #64748b; text-transform: uppercase; font-weight: 600;">
                                            Promedio
                                        </div>
                                    </div>
                                    <div class="metric-responsive" style="text-align: center; min-width: 50px;">
                                        <div class="metric-value-responsive" style="font-size: 1.2rem; font-weight: 700; color: #10b981; line-height: 1;">
                                            ${correctas}
                                        </div>
                                        <div class="metric-label-responsive" style="font-size: 0.65rem; color: #64748b; text-transform: uppercase; font-weight: 600;">
                                            Correctas
                                        </div>
                                    </div>
                                    <div class="metric-responsive" style="text-align: center; min-width: 50px;">
                                        <div class="metric-value-responsive" style="font-size: 1.2rem; font-weight: 700; color: #64748b; line-height: 1;">
                                            ${total}
                                        </div>
                                        <div class="metric-label-responsive" style="font-size: 0.65rem; color: #64748b; text-transform: uppercase; font-weight: 600;">
                                            Total
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Barra de progreso responsiva -->
                            <div class="progress-section-responsive" style="margin-top: 1rem;">
                                <div class="progress-header-responsive" style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    margin-bottom: 0.5rem;
                                    flex-wrap: wrap;
                                    gap: 0.5rem;
                                ">
                                    <span class="progress-title-responsive" style="font-size: 0.7rem; color: #64748b; font-weight: 600; white-space: nowrap;">Progreso del Tema</span>
                                    <span class="progress-percentage-responsive" style="font-size: 0.7rem; color: #64748b; font-weight: 700; white-space: nowrap;">${accuracy}% de efectividad</span>
                                </div>
                                <div class="progress-bar-responsive" style="
                                    width: 100%;
                                    height: 6px;
                                    background: #e2e8f0;
                                    border-radius: 3px;
                                    overflow: hidden;
                                    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
                                ">
                                    <div class="progress-fill-responsive" style="
                                        width: ${accuracy}%;
                                        height: 100%;
                                        background: linear-gradient(90deg, ${getScoreColor(accuracy)}, ${getScoreColor(accuracy)}dd);
                                        border-radius: 3px;
                                        transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
                                        box-shadow: 0 1px 6px rgba(0,0,0,0.2);
                                    "></div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Gr√°fico mejorado complementario al dise√±o de tarjetas
            const ctx = document.getElementById('themeChart');
            if (ctx) {

                if (ctx.chart) {
                    ctx.chart.destroy();
                }

                const themes = ['HTML', 'CSS', 'Condicionales', 'While'];
                const data = themes.map(theme => {
                    const stat = themeStats.find(s => s.tema === theme);
                    if (stat && stat.total_respuestas > 0) {
                        return Math.round((stat.respuestas_correctas / stat.total_respuestas) * 100);
                    }
                    return 0;
                });

                ctx.chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: themes,
                        datasets: [{
                            label: '% de Respuestas Correctas',
                            data: data,
                            backgroundColor: [
                                '#f97316', // HTML - Orange
                                '#3b82f6', // CSS - Blue
                                '#10b981', // Condicionales - Green
                                '#8b5cf6'  // While - Purple
                            ],
                            borderRadius: 8,
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            title: {
                                display: true,
                                text: 'Gr√°fico de Rendimiento Comparativo',
                                font: { size: 16 }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    callback: function (value) {
                                        return value + '%';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }

        function displayStudentsList(students) {
            const container = document.getElementById('studentsList');
            const counterElement = document.getElementById('studentsCounter');

            // Actualizar contador
            counterElement.textContent = `${students.length} Estudiante${students.length !== 1 ? 's' : ''}`;

            if (students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="
                        text-align: center;
                        padding: 40px 20px;
                        color: #64748b;
                    ">
                        <div style="font-size: 4rem; margin-bottom: 16px;">üë•</div>
                        <h5 style="color: #64748b; margin-bottom: 8px;">No hay estudiantes registrados</h5>
                        <p style="color: #94a3b8; font-size: 0.9rem;">Los estudiantes aparecer√°n aqu√≠ una vez que se registren en el curso</p>
                    </div>
                `;
                return;
            }

            // Nuevo dise√±o con tarjetas de estudiantes
            container.innerHTML = `
                <div class="students-grid-responsive" style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                    gap: 1rem;
                    margin-top: 0.5rem;
                    padding: 0.5rem;
                ">
                    ${students.map(student => {
                const accuracy = student.total_respuestas > 0 ?
                    Math.round((student.respuestas_correctas / student.total_respuestas) * 100) : 0;

                const getPerformanceLevel = (acc) => {
                    if (acc >= 80) return { level: 'Excelente', color: '#10b981', bg: '#dcfce7' };
                    if (acc >= 60) return { level: 'Bueno', color: '#f59e0b', bg: '#fef3c7' };
                    if (acc >= 40) return { level: 'Regular', color: '#f97316', bg: '#fed7aa' };
                    return { level: 'Necesita Mejorar', color: '#ef4444', bg: '#fecaca' };
                };

                const performance = getPerformanceLevel(accuracy);
                const initials = student.username.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);

                return `
                            <div class="student-card" style="
                                background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
                                border: 2px solid ${performance.color}30;
                                border-radius: 16px;
                                padding: 20px;
                                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                                transition: all 0.3s ease;
                                position: relative;
                                overflow: hidden;
                            " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 30px rgba(0, 0, 0, 0.12)'"
                               onmouseout="this.style.transform='translateY(0px)'; this.style.boxShadow='0 4px 20px rgba(0, 0, 0, 0.08)'">
                               
                                <!-- Header del estudiante -->
                                <div style="
                                    display: flex;
                                    align-items: center;
                                    gap: 15px;
                                    margin-bottom: 15px;
                                ">
                                    <div class="student-avatar" style="
                                        width: 50px;
                                        height: 50px;
                                        border-radius: 12px;
                                        background: linear-gradient(135deg, ${performance.color}, ${performance.color}dd);
                                        display: flex;
                                        align-items: center;
                                        justify-content: center;
                                        color: white;
                                        font-weight: 800;
                                        font-size: 1.1rem;
                                    ">
                                        ${initials}
                                    </div>
                                    <div style="flex: 1;">
                                        <h6 style="margin: 0; color: #1e293b; font-weight: 700; font-size: 1.1rem;">
                                            ${student.username}
                                        </h6>
                                        <p style="margin: 0; color: #64748b; font-size: 0.85rem;">
                                            ${student.email}
                                        </p>
                                    </div>
                                    <div class="performance-badge" style="
                                        background: ${performance.bg};
                                        color: ${performance.color};
                                        padding: 4px 12px;
                                        border-radius: 20px;
                                        font-size: 0.75rem;
                                        font-weight: 700;
                                        border: 1px solid ${performance.color}40;
                                    ">
                                        ${performance.level}
                                    </div>
                                </div>
                                
                                <!-- M√©tricas principales -->
                                <div class="student-metrics" style="
                                    display: grid;
                                    grid-template-columns: repeat(3, 1fr);
                                    gap: 12px;
                                    margin-bottom: 15px;
                                ">
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.4rem; font-weight: 800; color: ${performance.color};">
                                            ${accuracy}%
                                        </div>
                                        <div style="font-size: 0.7rem; color: #64748b; text-transform: uppercase; font-weight: 600;">
                                            Precisi√≥n
                                        </div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.4rem; font-weight: 800; color: #10b981;">
                                            ${student.respuestas_correctas}
                                        </div>
                                        <div style="font-size: 0.7rem; color: #64748b; text-transform: uppercase; font-weight: 600;">
                                            Correctas
                                        </div>
                                    </div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 1.4rem; font-weight: 800; color: #64748b;">
                                            ${student.total_respuestas || 0}
                                        </div>
                                        <div style="font-size: 0.7rem; color: #64748b; text-transform: uppercase; font-weight: 600;">
                                            Total
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Barra de progreso -->
                                <div style="margin-bottom: 15px;">
                                    <div style="
                                        width: 100%;
                                        height: 6px;
                                        background: #e2e8f0;
                                        border-radius: 3px;
                                        overflow: hidden;
                                    ">
                                        <div style="
                                            width: ${accuracy}%;
                                            height: 100%;
                                            background: linear-gradient(90deg, ${performance.color}, ${performance.color}dd);
                                            border-radius: 3px;
                                            transition: width 1s ease;
                                        "></div>
                                    </div>
                                </div>
                                
                                <!-- Informaci√≥n adicional -->
                                <div style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    font-size: 0.8rem;
                                    color: #64748b;
                                    margin-bottom: 15px;
                                ">
                                    <span>‚è±Ô∏è Promedio: ${student.tiempo_promedio ? Math.round(student.tiempo_promedio) + 's' : 'N/A'}</span>
                                    <span>ÔøΩ ${student.ultima_actividad ? new Date(student.ultima_actividad).toLocaleDateString('es-ES') : 'Sin actividad'}</span>
                                </div>
                                
                                <!-- Bot√≥n de acci√≥n -->
                                <button class="btn-view-detail" style="
                                    width: 100%;
                                    background: linear-gradient(135deg, ${performance.color}, ${performance.color}dd);
                                    color: white;
                                    border: none;
                                    border-radius: 10px;
                                    padding: 10px;
                                    font-weight: 600;
                                    font-size: 0.9rem;
                                    cursor: pointer;
                                    transition: all 0.2s ease;
                                " onclick="viewStudentDetail(${student.id})"
                                   onmouseover="this.style.transform='scale(1.02)'"
                                   onmouseout="this.style.transform='scale(1)'">
                                    <i class="fas fa-chart-line me-2"></i>Ver An√°lisis Detallado
                                </button>
                            </div>
                        `;
            }).join('')}
                </div>
            `;
        }

        async function viewStudentDetail(studentId) {
            try {
                const response = await fetch(`/api/teacher/student-details/${studentId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('Datos del estudiante recibidos:', data); // Debug
                    showStudentDetail(data);
                } else {
                    const errorData = await response.json().catch(() => ({}));
                    console.error('Error del servidor:', errorData);
                    alert(`Error cargando detalles del estudiante: ${errorData.error || 'Error desconocido'}`);
                }
            } catch (error) {
                console.error('Error de conexi√≥n:', error);
                alert('Error de conexi√≥n al servidor');
            }
        }

        function showStudentDetail(data) {
            // Validar que tenemos los datos necesarios
            if (!data || !data.student) {
                alert('Error: Datos del estudiante no v√°lidos');
                return;
            }

            document.getElementById('courseStats').style.display = 'none';
            document.getElementById('studentDetail').style.display = 'block';
            document.getElementById('studentTitle').textContent = `üë§ Detalle Completo - ${data.student.username}`;

            const answers = data.answers || []; // Asegurar que answers sea un array
            const correctAnswers = answers.filter(a => a.es_correcta).length;
            const totalAnswers = answers.length;
            const accuracy = totalAnswers > 0 ? Math.round((correctAnswers / totalAnswers) * 100) : 0;

            // Vista compacta y moderna del resumen del estudiante
            const getPerformanceColor = (acc) => {
                if (acc >= 80) return '#10b981';
                if (acc >= 60) return '#f59e0b';
                return '#ef4444';
            };

            const initials = data.student.username.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);

            document.getElementById('studentInfo').innerHTML = `
                <!-- Header compacto y responsivo del estudiante -->
                <div class="student-header-responsive" style="
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                    border-radius: 16px;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    border: 2px solid ${getPerformanceColor(accuracy)}40;
                    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
                ">
                    <!-- Layout responsivo que cambia seg√∫n el tama√±o -->
                    <div style="
                        display: grid;
                        grid-template-columns: 1fr;
                        gap: 1.5rem;
                        align-items: start;
                    " class="student-header-grid">
                        
                        <!-- Secci√≥n principal: Avatar + Datos + M√©tricas principales -->
                        <div style="
                            display: grid;
                            grid-template-columns: auto 1fr auto;
                            gap: 1rem;
                            align-items: center;
                        " class="main-info-section">
                            
                            <!-- Avatar y datos b√°sicos -->
                            <div style="
                                display: flex;
                                align-items: center;
                                gap: 0.8rem;
                            " class="student-basic-info">
                                <div style="
                                    width: 50px;
                                    height: 50px;
                                    border-radius: 12px;
                                    background: linear-gradient(135deg, ${getPerformanceColor(accuracy)}, ${getPerformanceColor(accuracy)}dd);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    color: white;
                                    font-weight: 800;
                                    font-size: 1.1rem;
                                " class="student-avatar">
                                    ${initials}
                                </div>
                                <div class="student-details">
                                    <h5 style="margin: 0; color: #1e293b; font-weight: 700; font-size: 1.1rem;">
                                        ${data.student.username}
                                    </h5>
                                    <p style="margin: 2px 0 0 0; color: #64748b; font-size: 0.8rem;">
                                        üìß ${data.student.email}
                                    </p>
                                    <p style="margin: 2px 0 0 0; color: #64748b; font-size: 0.75rem;">
                                        üìÖ ${new Date(data.student.created_at).toLocaleDateString('es-ES')} ‚Ä¢ üéì ${data.student.curso}
                                    </p>
                                </div>
                            </div>

                            <!-- Spacer flexible -->
                            <div></div>

                            <!-- M√©tricas principales -->
                            <div style="
                                display: grid;
                                grid-template-columns: repeat(3, 1fr);
                                gap: 1rem;
                                text-align: center;
                                min-width: 200px;
                            " class="main-metrics">
                                <div>
                                    <div style="
                                        font-size: 1.6rem;
                                        font-weight: 800;
                                        color: ${getPerformanceColor(accuracy)};
                                        line-height: 1;
                                    " class="metric-value">
                                        ${accuracy}%
                                    </div>
                                    <div style="
                                        font-size: 0.65rem;
                                        color: #64748b;
                                        text-transform: uppercase;
                                        font-weight: 600;
                                        margin-top: 2px;
                                    " class="metric-label">
                                        Precisi√≥n
                                    </div>
                                </div>
                                <div>
                                    <div style="
                                        font-size: 1.6rem;
                                        font-weight: 800;
                                        color: #10b981;
                                        line-height: 1;
                                    " class="metric-value">
                                        ${correctAnswers}
                                    </div>
                                    <div style="
                                        font-size: 0.65rem;
                                        color: #64748b;
                                        text-transform: uppercase;
                                        font-weight: 600;
                                        margin-top: 2px;
                                    " class="metric-label">
                                        Correctas
                                    </div>
                                </div>
                                <div>
                                    <div style="
                                        font-size: 1.6rem;
                                        font-weight: 800;
                                        color: #64748b;
                                        line-height: 1;
                                    " class="metric-value">
                                        ${totalAnswers}
                                    </div>
                                    <div style="
                                        font-size: 0.65rem;
                                        color: #64748b;
                                        text-transform: uppercase;
                                        font-weight: 600;
                                        margin-top: 2px;
                                    " class="metric-label">
                                        /40 Total
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Resumen por temas responsivo -->
                        <div style="
                            background: rgba(255, 255, 255, 0.7);
                            border-radius: 12px;
                            padding: 1rem;
                            border: 1px solid #e2e8f0;
                        " class="themes-summary-responsive">
                            <h6 style="
                                margin: 0 0 0.8rem 0;
                                color: #475569;
                                font-size: 0.85rem;
                                font-weight: 700;
                                text-align: center;
                            ">
                                üìä Rendimiento por Tema
                            </h6>
                            <div style="
                                display: grid;
                                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                                gap: 0.6rem;
                            " class="themes-grid-responsive">
                                ${['HTML', 'CSS', 'Condicionales', 'While'].map(theme => {
                const themeAnswers = answers.filter(a => a.tema === theme);
                const themeCorrect = themeAnswers.filter(a => a.es_correcta).length;
                const themeAccuracy = themeAnswers.length > 0 ? Math.round((themeCorrect / themeAnswers.length) * 100) : 0;
                const themeColor = themeAccuracy >= 70 ? '#10b981' : themeAccuracy >= 50 ? '#f59e0b' : '#ef4444';

                return `
                                        <div style="
                                            background: white;
                                            border-radius: 8px;
                                            padding: 0.6rem;
                                            border-left: 3px solid ${themeColor};
                                            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
                                            transition: transform 0.2s ease;
                                        " onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'">
                                            <div style="
                                                display: flex;
                                                justify-content: space-between;
                                                align-items: center;
                                                gap: 0.5rem;
                                            ">
                                                <span style="
                                                    font-size: 0.75rem;
                                                    font-weight: 600;
                                                    color: #374151;
                                                    white-space: nowrap;
                                                    overflow: hidden;
                                                    text-overflow: ellipsis;
                                                ">
                                                    ${theme}
                                                </span>
                                                <span style="
                                                    font-size: 0.7rem;
                                                    font-weight: 700;
                                                    color: ${themeColor};
                                                    white-space: nowrap;
                                                ">
                                                    ${themeCorrect}/${themeAnswers.length}
                                                </span>
                                            </div>
                                        </div>
                                    `;
            }).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <style>
                    @media (max-width: 768px) {
                        .main-info-section {
                            grid-template-columns: 1fr !important;
                            text-align: center;
                            gap: 1rem !important;
                        }
                        .student-basic-info {
                            justify-content: center;
                            flex-direction: column;
                            gap: 0.5rem !important;
                        }
                        .student-avatar {
                            width: 45px !important;
                            height: 45px !important;
                            font-size: 1rem !important;
                        }
                        .main-metrics {
                            min-width: unset !important;
                            grid-template-columns: repeat(3, 1fr) !important;
                            gap: 0.8rem !important;
                        }
                        .metric-value {
                            font-size: 1.3rem !important;
                        }
                        .themes-grid-responsive {
                            grid-template-columns: repeat(2, 1fr) !important;
                            gap: 0.4rem !important;
                        }
                    }
                    
                    @media (max-width: 480px) {
                        .student-header-responsive {
                            padding: 1rem !important;
                            margin-bottom: 1rem !important;
                        }
                        .student-avatar {
                            width: 40px !important;
                            height: 40px !important;
                            font-size: 0.9rem !important;
                        }
                        .metric-value {
                            font-size: 1.1rem !important;
                        }
                        .metric-label {
                            font-size: 0.6rem !important;
                        }
                        .themes-summary-responsive {
                            padding: 0.8rem !important;
                        }
                    }
                </style>
            `;

            // Vista ultra compacta de respuestas por tema
            const themes = ['HTML', 'CSS', 'Condicionales', 'While'];
            const themeIcons = ['üèóÔ∏è', 'üé®', 'üîÄ', 'üîÑ'];

            const answersHtml = `
                <div class="themes-responses-container" style="
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                    gap: 1rem;
                    margin-top: 1rem;
                    padding: 0.5rem;
                ">
                    ${themes.map((theme, themeIndex) => {
                const themeAnswers = answers.filter(a => a.tema === theme);

                if (themeAnswers.length === 0) {
                    return `
                                <div class="empty-theme-card" style="
                                    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                                    border-radius: 12px;
                                    padding: 1.5rem;
                                    border: 2px dashed #cbd5e1;
                                    text-align: center;
                                    min-height: 200px;
                                    display: flex;
                                    flex-direction: column;
                                    justify-content: center;
                                ">
                                    <div style="font-size: 1.8rem; margin-bottom: 0.5rem;">${themeIcons[themeIndex]}</div>
                                    <h6 style="color: #64748b; margin-bottom: 0.5rem; font-weight: 600; font-size: 1rem;">${theme}</h6>
                                    <p style="color: #94a3b8; font-size: 0.8rem; margin: 0;">
                                        Sin respuestas a√∫n
                                    </p>
                                </div>
                            `;
                }

                const themeCorrect = themeAnswers.filter(a => a.es_correcta).length;
                const themeAccuracy = Math.round((themeCorrect / themeAnswers.length) * 100);
                const themeColor = themeAccuracy >= 80 ? '#10b981' : themeAccuracy >= 60 ? '#f59e0b' : '#ef4444';

                return `
                            <div class="theme-responses-card" style="
                                background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
                                border: 2px solid ${themeColor}40;
                                border-radius: 12px;
                                padding: 1rem;
                                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
                                transition: transform 0.2s ease;
                            " onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                                
                                <!-- Header del tema responsivo -->
                                <div class="theme-header-responsive" style="
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    margin-bottom: 1rem;
                                    padding-bottom: 0.8rem;
                                    border-bottom: 2px solid #e2e8f0;
                                    flex-wrap: wrap;
                                    gap: 0.5rem;
                                ">
                                    <div style="
                                        display: flex;
                                        align-items: center;
                                        gap: 0.6rem;
                                        flex: 1;
                                        min-width: 120px;
                                    ">
                                        <div style="
                                            width: 32px;
                                            height: 32px;
                                            border-radius: 8px;
                                            background: linear-gradient(135deg, ${themeColor}, ${themeColor}dd);
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            color: white;
                                            font-size: 1rem;
                                        " class="theme-icon-responsive">
                                            ${themeIcons[themeIndex]}
                                        </div>
                                        <div>
                                            <h6 style="margin: 0; color: #1e293b; font-weight: 700; font-size: 0.9rem;" class="theme-title-responsive">
                                                ${theme}
                                            </h6>
                                            <small style="color: #64748b; font-size: 0.75rem;" class="theme-subtitle">
                                                ${themeAnswers.length} pregunta${themeAnswers.length !== 1 ? 's' : ''}
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <div class="theme-metrics-responsive" style="
                                        display: flex;
                                        align-items: center;
                                        gap: 0.6rem;
                                        flex-wrap: wrap;
                                    ">
                                        <div style="
                                            background: ${themeColor}20;
                                            color: ${themeColor};
                                            padding: 3px 6px;
                                            border-radius: 6px;
                                            font-size: 0.7rem;
                                            font-weight: 700;
                                            white-space: nowrap;
                                        ">
                                            ${themeCorrect}/${themeAnswers.length}
                                        </div>
                                        <div style="
                                            font-size: 1.1rem;
                                            font-weight: 800;
                                            color: ${themeColor};
                                            white-space: nowrap;
                                        ">
                                            ${themeAccuracy}%
                                        </div>
                                    </div>
                                </div>

                                <!-- Grid de respuestas ultra responsivo -->
                                <div class="answers-grid-responsive" style="
                                    display: grid;
                                    grid-template-columns: repeat(auto-fit, minmax(40px, 1fr));
                                    gap: 4px;
                                    margin-bottom: 1rem;
                                ">
                                    ${themeAnswers
                        .sort((a, b) => a.pregunta_numero - b.pregunta_numero)
                        .map((answer) => {
                            const isCorrect = answer.es_correcta;
                            return `
                                                <div class="answer-bubble-responsive ${isCorrect ? 'correct' : 'incorrect'}" style="
                                                    background: ${isCorrect ? '#dcfce7' : '#fecaca'};
                                                    border: 2px solid ${isCorrect ? '#22c55e' : '#ef4444'};
                                                    border-radius: 6px;
                                                    padding: 6px 4px;
                                                    text-align: center;
                                                    cursor: pointer;
                                                    transition: all 0.2s ease;
                                                    min-height: 35px;
                                                    display: flex;
                                                    flex-direction: column;
                                                    justify-content: center;
                                                " title="Pregunta ${answer.pregunta_numero + 1}: Respondi√≥ '${answer.respuesta_seleccionada}' ${isCorrect ? '(Correcto)' : '(Incorrecto)'}"
                                                   onmouseover="this.style.transform='scale(1.05)'"
                                                   onmouseout="this.style.transform='scale(1)'">
                                                    <div style="
                                                        font-size: 0.65rem;
                                                        font-weight: 700;
                                                        color: ${isCorrect ? '#16a34a' : '#dc2626'};
                                                        line-height: 1;
                                                        margin-bottom: 1px;
                                                    ">
                                                        P${answer.pregunta_numero + 1}
                                                    </div>
                                                    <div style="
                                                        font-size: 0.75rem;
                                                        font-weight: 800;
                                                        color: ${isCorrect ? '#16a34a' : '#dc2626'};
                                                        line-height: 1;
                                                    ">
                                                        ${answer.respuesta_seleccionada}
                                                    </div>
                                                </div>
                                            `;
                        }).join('')
                    }
                                </div>
                                
                                <!-- Barra de progreso del tema -->
                                <div class="theme-progress" style="margin-top: 0.8rem;">
                                    <div style="
                                        width: 100%;
                                        height: 5px;
                                        background: #e2e8f0;
                                        border-radius: 2px;
                                        overflow: hidden;
                                    ">
                                        <div style="
                                            width: ${themeAccuracy}%;
                                            height: 100%;
                                            background: linear-gradient(90deg, ${themeColor}, ${themeColor}dd);
                                            border-radius: 2px;
                                            transition: width 1s ease;
                                        "></div>
                                    </div>
                                </div>
                            </div>
                        `;
            }).join('')}
                </div>

                <style>
                    /* Estilos responsivos para las tarjetas de temas */
                    @media (max-width: 768px) {
                        .themes-responses-container {
                            grid-template-columns: 1fr !important;
                            gap: 0.8rem !important;
                            padding: 0.25rem !important;
                        }
                        
                        .theme-responses-card {
                            padding: 0.8rem !important;
                            border-radius: 10px !important;
                        }
                        
                        .theme-header-responsive {
                            flex-direction: column !important;
                            align-items: flex-start !important;
                            gap: 0.8rem !important;
                        }
                        
                        .theme-metrics-responsive {
                            align-self: stretch !important;
                            justify-content: space-between !important;
                        }
                        
                        .answers-grid-responsive {
                            grid-template-columns: repeat(5, 1fr) !important;
                            gap: 3px !important;
                        }
                        
                        .answer-bubble-responsive {
                            padding: 4px 2px !important;
                            min-height: 32px !important;
                        }
                        
                        .empty-theme-card {
                            padding: 1rem !important;
                            min-height: 150px !important;
                        }
                    }

                    @media (max-width: 576px) {
                        .themes-responses-container {
                            gap: 0.6rem !important;
                            margin-top: 0.5rem !important;
                        }
                        
                        .theme-responses-card {
                            padding: 0.6rem !important;
                        }
                        
                        .theme-icon-responsive {
                            width: 28px !important;
                            height: 28px !important;
                            font-size: 0.9rem !important;
                        }
                        
                        .theme-title-responsive {
                            font-size: 0.8rem !important;
                        }
                        
                        .theme-subtitle {
                            font-size: 0.7rem !important;
                        }
                        
                        .answers-grid-responsive {
                            grid-template-columns: repeat(4, 1fr) !important;
                            gap: 2px !important;
                        }
                        
                        .answer-bubble-responsive {
                            padding: 3px 1px !important;
                            min-height: 28px !important;
                            border-radius: 4px !important;
                        }
                    }

                    @media (max-width: 480px) {
                        .themes-responses-container {
                            padding: 0 !important;
                        }
                        
                        .theme-responses-card {
                            padding: 0.5rem !important;
                            border-radius: 8px !important;
                        }
                        
                        .answers-grid-responsive {
                            grid-template-columns: repeat(3, 1fr) !important;
                            gap: 2px !important;
                        }
                        
                        .answer-bubble-responsive {
                            padding: 2px !important;
                            min-height: 25px !important;
                            font-size: 0.6rem !important;
                        }
                        
                        .empty-theme-card {
                            padding: 0.8rem !important;
                            min-height: 120px !important;
                        }
                    }

                    /* Estilos adicionales para mejorar la legibilidad en m√≥vil */
                    @media (max-width: 320px) {
                        .answer-bubble-responsive div {
                            font-size: 0.55rem !important;
                        }
                        
                        .theme-responses-card {
                            padding: 0.4rem !important;
                        }
                    }
                </style>
            `;

            document.getElementById('studentAnswers').innerHTML = answersHtml;
        }

        function goBackToStats() {
            document.getElementById('studentDetail').style.display = 'none';
            document.getElementById('courseStats').style.display = 'block';
        }

        function showCourseSelector() {
            document.getElementById('courseStats').style.display = 'none';
            document.getElementById('studentDetail').style.display = 'none';
            document.getElementById('courseSelector').style.display = 'block';
        }

        function logout() {
            localStorage.removeItem('retotech_token');
            localStorage.removeItem('retotech_user');
            window.location.href = 'login.html';
        }

        // Agregar estilos CSS responsivos adicionales
        const responsiveStyles = document.createElement('style');
        responsiveStyles.textContent = `
            /* Responsividad global mejorada */
            .container-fluid {
                padding: 0.5rem;
            }
            
            /* Grid de estudiantes responsivo */
            @media (max-width: 768px) {
                .students-grid-responsive {
                    grid-template-columns: 1fr !important;
                    gap: 0.8rem !important;
                    padding: 0.25rem !important;
                }
                
                .student-card {
                    padding: 0.8rem !important;
                    border-radius: 12px !important;
                }
                
                .student-metrics {
                    grid-template-columns: repeat(3, 1fr) !important;
                    gap: 0.8rem !important;
                }
            }

            @media (max-width: 576px) {
                .students-grid-responsive {
                    padding: 0 !important;
                    margin-top: 0.25rem !important;
                }
                
                .student-card {
                    padding: 0.6rem !important;
                    border-radius: 10px !important;
                }
                
                .student-avatar {
                    width: 40px !important;
                    height: 40px !important;
                }
                
                .student-metrics div div:first-child {
                    font-size: 1.2rem !important;
                }
            }

            @media (max-width: 480px) {
                .student-card {
                    padding: 0.5rem !important;
                }
                
                .student-metrics {
                    gap: 0.6rem !important;
                }
                
                .student-avatar {
                    width: 35px !important;
                    height: 35px !important;
                }
            }

            /* Gr√°ficos y contenedores responsivos */
            @media (max-width: 768px) {
                .chart-section {
                    margin-top: 20px !important;
                    padding: 15px !important;
                }
                
                .themes-container {
                    display: grid !important;
                    grid-template-columns: 1fr !important;
                    gap: 1rem !important;
                    padding: 0.5rem !important;
                }
                
                .theme-performance-card, .theme-performance-card-responsive {
                    padding: 15px !important;
                }
            }

            @media (max-width: 576px) {
                .chart-section {
                    padding: 10px !important;
                    margin-top: 15px !important;
                }
                
                .theme-performance-card {
                    padding: 10px !important;
                    border-radius: 15px !important;
                }
                
                .theme-icon {
                    width: 35px !important;
                    height: 35px !important;
                    font-size: 1.1rem !important;
                }
                
                .metric div:first-child {
                    font-size: 1.4rem !important;
                }
            }

            /* Navegaci√≥n y botones responsivos */
            @media (max-width: 768px) {
                .btn {
                    padding: 0.4rem 0.8rem !important;
                    font-size: 0.85rem !important;
                }
                
                .card-header h5 {
                    font-size: 1rem !important;
                }
            }

            /* Responsividad para tarjetas de rendimiento por tema */
            @media (max-width: 768px) {
                .theme-performance-card-responsive {
                    padding: 1rem !important;
                    border-radius: 12px !important;
                    margin-bottom: 0.8rem !important;
                }
                
                .theme-header-responsive {
                    flex-direction: column !important;
                    align-items: flex-start !important;
                    gap: 0.8rem !important;
                }
                
                .theme-title-responsive {
                    min-width: unset !important;
                }
                
                .theme-metrics-responsive {
                    align-self: stretch !important;
                    justify-content: space-around !important;
                }
                
                .theme-icon-responsive {
                    width: 35px !important;
                    height: 35px !important;
                    font-size: 1.1rem !important;
                }
                
                .theme-title-text {
                    font-size: 1rem !important;
                }
                
                .metric-value-responsive {
                    font-size: 1.4rem !important;
                }
            }

            @media (max-width: 576px) {
                .theme-performance-card-responsive {
                    padding: 0.8rem !important;
                    border-radius: 10px !important;
                }
                
                .theme-icon-responsive {
                    width: 30px !important;
                    height: 30px !important;
                    font-size: 1rem !important;
                }
                
                .theme-title-text {
                    font-size: 0.9rem !important;
                }
                
                .theme-subtitle-text {
                    font-size: 0.7rem !important;
                }
                
                .metric-responsive {
                    min-width: 45px !important;
                }
                
                .metric-value-responsive {
                    font-size: 1.2rem !important;
                }
                
                .metric-label-responsive {
                    font-size: 0.6rem !important;
                }
                
                .progress-header-responsive {
                    flex-direction: column !important;
                    align-items: flex-start !important;
                    gap: 0.25rem !important;
                }
                
                .progress-bar-responsive {
                    height: 5px !important;
                }
            }

            @media (max-width: 480px) {
                .theme-performance-card-responsive {
                    padding: 0.6rem !important;
                    border-radius: 8px !important;
                }
                
                .theme-header-responsive {
                    gap: 0.6rem !important;
                }
                
                .theme-metrics-responsive {
                    gap: 0.6rem !important;
                }
                
                .metric-responsive {
                    min-width: 40px !important;
                }
                
                .metric-value-responsive {
                    font-size: 1.1rem !important;
                }
                
                .progress-title-responsive,
                .progress-percentage-responsive {
                    font-size: 0.65rem !important;
                }
            }

            /* Optimizaci√≥n para pantallas muy peque√±as */
            @media (max-width: 360px) {
                .container-fluid {
                    padding: 0.25rem;
                }
                
                .student-card, .theme-performance-card-responsive, .theme-responses-card {
                    margin-bottom: 0.5rem !important;
                }
                
                .theme-performance-card-responsive {
                    padding: 0.5rem !important;
                }
                
                .theme-icon-responsive {
                    width: 25px !important;
                    height: 25px !important;
                    font-size: 0.9rem !important;
                }
                
                .theme-title-text {
                    font-size: 0.8rem !important;
                }
                
                .metric-value-responsive {
                    font-size: 1rem !important;
                }
                
                h4, h5 {
                    font-size: 0.9rem !important;
                }
                
                .btn {
                    font-size: 0.75rem !important;
                    padding: 0.3rem 0.6rem !important;
                }
            }
        `;
        document.head.appendChild(responsiveStyles);
    </script>
</body>

</html>