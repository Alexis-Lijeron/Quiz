<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Estudiante - RetoTech</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Navegaci√≥n Responsiva -->
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg bg-dark border-bottom border-body" data-bs-theme="dark">
            <div class="container-fluid px-3">
                <a class="navbar-brand" href="#">üéì RetoTech - Estudiante</a>

                <!-- Informaci√≥n del usuario en m√≥viles -->
                <div class="d-flex align-items-center d-lg-none">
                    <span class="user-info me-2 text-light small">üëã <span id="currentUserNameMobile"></span></span>
                    <span class="badge bg-info me-2 small" id="currentCourseMobile"></span>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                </div>

                <!-- Informaci√≥n del usuario en escritorio -->
                <div class="d-none d-lg-flex align-items-center">
                    <span class="user-info me-3">üëã <span id="currentUserName"></span></span>
                    <span class="badge bg-info me-3" id="currentCourse"></span>
                </div>

                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" onclick="showMainMenu()">
                                <i class="fas fa-home me-1"></i>Inicio
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showStatistics()">
                                <i class="fas fa-chart-bar me-1"></i>Mis Estad√≠sticas
                            </a>
                        </li>
                        <li class="nav-item">
                            <button class="btn btn-outline-danger btn-sm ms-2" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesi√≥n
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <!-- Men√∫ Principal -->
    <div class="card-container" id="main-menu">
        <div class="card" onclick="startQuiz('HTML')">
            <h3>HTML</h3>
            <p>Estructura web</p>
            <div class="score-board" id="score-HTML">Puntaje: 0/30</div>
        </div>
        <div class="card" onclick="startQuiz('CSS')">
            <h3>CSS</h3>
            <p>Estilos y dise√±o</p>
            <div class="score-board" id="score-CSS">Puntaje: 0/30</div>
        </div>
        <div class="card" onclick="startQuiz('Condicionales')">
            <h3>Condicionales</h3>
            <p>L√≥gica de decisi√≥n</p>
            <div class="score-board" id="score-Condicionales">Puntaje: 0/30</div>
        </div>
        <div class="card" onclick="startQuiz('While')">
            <h3>While</h3>
            <p>Bucles y repeticiones</p>
            <div class="score-board" id="score-While">Puntaje: 0/30</div>
        </div>
    </div>

    <!-- Quiz Section -->
    <div class="quiz-container" id="quiz-section" style="display: none;">
        <div class="quiz-header">
            <div class="quiz-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <span class="progress-text" id="progress-text">Pregunta 1 de 30</span>
            </div>
            <div class="quiz-theme" id="quiz-theme">HTML</div>
        </div>

        <div class="quiz-content">
            <div class="quiz-question">
                <div class="question-number" id="question-number">1</div>
                <h3 id="question-text"></h3>
            </div>

            <div class="options-container" id="options-container"></div>

            <div class="quiz-controls">
                <button class="btn-quiz btn-primary" id="submit-btn" onclick="checkAnswer()">
                    <span>‚úì</span> Enviar Respuesta
                </button>
                <button class="btn-quiz btn-success" id="next-btn" onclick="nextQuestion()" style="display: none;">
                    <span>‚Üí</span> Siguiente Pregunta
                </button>
                <button class="btn-quiz btn-secondary" onclick="goBack()">
                    <span>‚Üê</span> Volver al men√∫
                </button>
            </div>

            <div class="quiz-message" id="message"></div>
        </div>
    </div>

    <!-- Modal de Resultados -->
    <div class="quiz-result-overlay" id="quiz-result-overlay" style="display: none;">
        <div class="quiz-result-modal">
            <div class="result-header">
                <div class="result-icon" id="result-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <h2 class="result-title" id="result-title">¬°Quiz Completado!</h2>
                <p class="result-theme" id="result-theme">HTML</p>
            </div>

            <div class="result-content">
                <div class="result-score-circle">
                    <div class="score-circle" id="score-circle">
                        <div class="score-percentage" id="score-percentage">80%</div>
                        <div class="score-text">Precisi√≥n</div>
                    </div>
                </div>

                <div class="result-stats">
                    <div class="stat-item">
                        <div class="stat-number correct" id="correct-answers">8</div>
                        <div class="stat-label">Correctas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number incorrect" id="incorrect-answers">2</div>
                        <div class="stat-label">Incorrectas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number total" id="total-answers">30</div>
                        <div class="stat-label">Total</div>
                    </div>
                </div>

                <div class="result-performance" id="result-performance">
                    <div class="performance-badge excellent" id="performance-badge">
                        <i class="fas fa-star"></i>
                        <span>¬°Excelente trabajo!</span>
                    </div>
                </div>

                <div class="result-actions">
                    <button class="btn-result btn-success" onclick="retryQuiz()">
                        <i class="fas fa-redo me-2"></i>Volver a Intentar
                    </button>
                    <button class="btn-result btn-primary" onclick="goBack()">
                        <i class="fas fa-home me-2"></i>Ir al Men√∫ Principal
                    </button>
                    <button class="btn-result btn-secondary" onclick="showStatistics()">
                        <i class="fas fa-chart-bar me-2"></i>Ver Estad√≠sticas
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modern-statistics" id="statistics" style="display: none;">
        <div class="stats-header">
            <h2 class="stats-title">üìä Tu Progreso</h2>
            <p class="stats-subtitle">Revisa tu rendimiento en cada tema y nivel</p>
        </div>

        <!-- Resumen Principal -->
        <div class="stats-summary">
            <div class="summary-card total-card">
                <div class="summary-icon">
                    <i class="fas fa-question-circle"></i>
                </div>
                <div class="summary-content">
                    <h3 id="totalQuestions">0</h3>
                    <p>Preguntas Respondidas</p>
                </div>
            </div>
            <div class="summary-card accuracy-card">
                <div class="summary-icon">
                    <i class="fas fa-bullseye"></i>
                </div>
                <div class="summary-content">
                    <h3 id="overallAccuracy">0%</h3>
                    <p>Precisi√≥n General</p>
                </div>
            </div>
        </div>

        <!-- Progreso por Temas con Niveles -->
        <div class="themes-progress">
            <!-- HTML -->
            <div class="theme-card" data-theme="HTML">
                <div class="theme-header">
                    <div class="theme-icon html-theme">
                        <i class="fab fa-html5"></i>
                    </div>
                    <div class="theme-info">
                        <h4>HTML</h4>
                        <p class="theme-description">Estructura web</p>
                    </div>
                </div>
                <div class="theme-levels">
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge basico">üìö B√°sico</span>
                            <span class="level-score" id="score-HTML-basico">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-HTML-basico" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge intermedio">üìñ Intermedio</span>
                            <span class="level-score" id="score-HTML-intermedio">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-HTML-intermedio" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge avanzado">üéì Avanzado</span>
                            <span class="level-score" id="score-HTML-avanzado">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-HTML-avanzado" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CSS -->
            <div class="theme-card" data-theme="CSS">
                <div class="theme-header">
                    <div class="theme-icon css-theme">
                        <i class="fab fa-css3-alt"></i>
                    </div>
                    <div class="theme-info">
                        <h4>CSS</h4>
                        <p class="theme-description">Estilos y dise√±o</p>
                    </div>
                </div>
                <div class="theme-levels">
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge basico">üìö B√°sico</span>
                            <span class="level-score" id="score-CSS-basico">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-CSS-basico" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge intermedio">üìñ Intermedio</span>
                            <span class="level-score" id="score-CSS-intermedio">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-CSS-intermedio" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge avanzado">üéì Avanzado</span>
                            <span class="level-score" id="score-CSS-avanzado">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-CSS-avanzado" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Condicionales -->
            <div class="theme-card" data-theme="Condicionales">
                <div class="theme-header">
                    <div class="theme-icon js-theme">
                        <i class="fas fa-code-branch"></i>
                    </div>
                    <div class="theme-info">
                        <h4>Condicionales</h4>
                        <p class="theme-description">Estructuras de control</p>
                    </div>
                </div>
                <div class="theme-levels">
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge basico">üìö B√°sico</span>
                            <span class="level-score" id="score-Condicionales-basico">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-Condicionales-basico" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge intermedio">üìñ Intermedio</span>
                            <span class="level-score" id="score-Condicionales-intermedio">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-Condicionales-intermedio" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge avanzado">üéì Avanzado</span>
                            <span class="level-score" id="score-Condicionales-avanzado">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-Condicionales-avanzado" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- While -->
            <div class="theme-card" data-theme="While">
                <div class="theme-header">
                    <div class="theme-icon loop-theme">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <div class="theme-info">
                        <h4>While</h4>
                        <p class="theme-description">Bucles y repetici√≥n</p>
                    </div>
                </div>
                <div class="theme-levels">
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge basico">üìö B√°sico</span>
                            <span class="level-score" id="score-While-basico">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-While-basico" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge intermedio">üìñ Intermedio</span>
                            <span class="level-score" id="score-While-intermedio">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-While-intermedio" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-progress">
                        <div class="level-info">
                            <span class="level-badge avanzado">üéì Avanzado</span>
                            <span class="level-score" id="score-While-avanzado">0/10</span>
                        </div>
                        <div class="level-bar">
                            <div class="level-fill" id="bar-While-avanzado" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="stats-footer">
            <button class="stats-back-btn" onclick="showMainMenu()">
                <i class="fas fa-arrow-left"></i>
                <span>Volver al men√∫</span>
            </button>
        </div>
    </div>

    <style>
        /* Estilos para niveles en las tarjetas de temas */
        .theme-levels {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .level-progress {
            background: rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .level-progress:hover {
            background: rgba(255, 255, 255, 0.8);
            transform: translateX(5px);
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .level-badge {
            font-size: 0.85rem;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .level-badge.basico {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .level-badge.intermedio {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .level-badge.avanzado {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .level-score {
            font-weight: 700;
            font-size: 1rem;
            color: #2d3748;
        }

        .level-bar {
            width: 100%;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .level-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, #10b981, #34d399);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .level-progress {
                padding: 0.8rem;
            }

            .level-badge {
                font-size: 0.75rem;
                padding: 3px 10px;
            }

            .level-score {
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .theme-levels {
                gap: 0.8rem;
            }

            .level-progress {
                padding: 0.6rem;
            }

            .level-info {
                flex-wrap: wrap;
                gap: 0.5rem;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Preguntas del quiz - necesarias para el dashboard del estudiante
        // PREGUNTAS ACTUALIZADAS - 30 por bloque (10 B√°sico, 10 Intermedio, 10 Avanzado)
        const allQuestions = {
            'HTML': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© significa HTML?', options: ['A) Hyper Transfer Machine Language', 'B) HyperText Markup Language', 'C) HighText Machine Language', 'D) HyperTool Manual Language'], correct: 'B' },
                { question: '¬øQu√© etiqueta indica el inicio del documento?', options: ['A) <head>', 'B) <!DOCTYPE html>', 'C) <html>', 'D) <body>'], correct: 'B' },
                { question: '¬øQu√© etiqueta se usa para insertar una imagen?', options: ['A) <image>', 'B) <img>', 'C) <src>', 'D) <picture>'], correct: 'B' },
                { question: '¬øCu√°l es la funci√≥n del atributo alt en una imagen?', options: ['A) Cambiar el tama√±o', 'B) Texto alternativo', 'C) Agregar un enlace', 'D) Definir el formato'], correct: 'B' },
                { question: '¬øQu√© etiqueta se usa para crear listas ordenadas?', options: ['A) <ol>', 'B) <ul>', 'C) <li>', 'D) <list>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para crear un enlace?', options: ['A) <a>', 'B) <link>', 'C) <href>', 'D) <url>'], correct: 'A' },
                { question: '¬øQu√© atributo abre un enlace en una nueva pesta√±a?', options: ['A) open="_blank"', 'B) target="_blank"', 'C) href="_blank"', 'D) window="new"'], correct: 'B' },
                { question: '¬øQu√© etiqueta define el encabezado principal?', options: ['A) <header>', 'B) <head>', 'C) <hgroup>', 'D) <h1>'], correct: 'A' },
                { question: '¬øCu√°l es la diferencia entre <div> y <span>?', options: ['A) div bloque / span l√≠nea', 'B) div l√≠nea / span bloque', 'C) no hay diferencia', 'D) div es obsoleto'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para formularios?', options: ['A) <form>', 'B) <input>', 'C) <section>', 'D) <field>'], correct: 'A' },

                // INTERMEDIO (11-20)
                { question: '¬øQu√© atributo de <input> define el tipo de dato?', options: ['A) value', 'B) type', 'C) data', 'D) kind'], correct: 'B' },
                { question: '¬øQu√© etiqueta agrupa opciones en un men√∫ desplegable?', options: ['A) <group>', 'B) <option>', 'C) <select>', 'D) <dropdown>'], correct: 'C' },
                { question: '¬øQu√© etiqueta define el pie de p√°gina?', options: ['A) <footer>', 'B) <bottom>', 'C) <end>', 'D) <base>'], correct: 'A' },
                { question: '¬øQu√© etiqueta define una celda de encabezado en una tabla?', options: ['A) <th>', 'B) <td>', 'C) <tr>', 'D) <thead>'], correct: 'A' },
                { question: '¬øQu√© etiqueta agrupa el contenido principal?', options: ['A) <main>', 'B) <body>', 'C) <article>', 'D) <content>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para t√≠tulos de distintos niveles?', options: ['A) <h1> - <h6>', 'B) <p>', 'C) <title>', 'D) <heading>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para separar secciones tem√°ticas?', options: ['A) <section>', 'B) <div>', 'C) <area>', 'D) <part>'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para incluir un script externo?', options: ['A) <script src="">', 'B) <code>', 'C) <import>', 'D) <js>'], correct: 'A' },
                { question: '¬øQu√© atributo define el texto que aparece al pasar el cursor?', options: ['A) alt', 'B) title', 'C) tooltip', 'D) hint'], correct: 'B' },
                { question: '¬øQu√© etiqueta permite insertar audio en una p√°gina web?', options: ['A) <sound>', 'B) <audio>', 'C) <music>', 'D) <media>'], correct: 'B' },

                // AVANZADO (21-30)
                { question: '¬øQu√© etiqueta define contenido independiente, como una noticia?', options: ['A) <article>', 'B) <section>', 'C) <div>', 'D) <content>'], correct: 'A' },
                { question: '¬øQu√© atributo se usa para identificar un elemento √∫nico?', options: ['A) class', 'B) id', 'C) key', 'D) name'], correct: 'B' },
                { question: '¬øQu√© etiqueta agrupa navegaci√≥n principal?', options: ['A) <nav>', 'B) <menu>', 'C) <path>', 'D) <navigation>'], correct: 'A' },
                { question: '¬øQu√© atributo muestra texto en un campo antes de escribir?', options: ['A) hint', 'B) value', 'C) placeholder', 'D) default'], correct: 'C' },
                { question: '¬øQu√© etiqueta representa contenido destacado visualmente?', options: ['A) <strong>', 'B) <mark>', 'C) <highlight>', 'D) <em>'], correct: 'B' },
                { question: '¬øQu√© etiqueta define una lista de definiciones?', options: ['A) <dl>', 'B) <ol>', 'C) <ul>', 'D) <def>'], correct: 'A' },
                { question: '¬øQu√© atributo en <img> define el texto alternativo?', options: ['A) src', 'B) alt', 'C) title', 'D) desc'], correct: 'B' },
                { question: '¬øQu√© etiqueta se usa para contenido externo como videos?', options: ['A) <iframe>', 'B) <video>', 'C) <embed>', 'D) <external>'], correct: 'A' },
                { question: '¬øQu√© atributo permite ejecutar una funci√≥n al hacer clic?', options: ['A) onclick', 'B) action', 'C) onpress', 'D) click'], correct: 'A' },
                { question: '¬øQu√© etiqueta se usa para definir una lista desplegable?', options: ['A) <select>', 'B) <input>', 'C) <options>', 'D) <dropdown>'], correct: 'A' }
            ],
            'CSS': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© significa CSS?', options: ['A) Cascading Style Sheets', 'B) Color Style Syntax', 'C) Computer Style Syntax', 'D) Creative Style System'], correct: 'A' },
                { question: '¬øQu√© propiedad cambia el color del texto?', options: ['A) font-color', 'B) text-color', 'C) color', 'D) text'], correct: 'C' },
                { question: '¬øQu√© propiedad cambia el color de fondo?', options: ['A) background-color', 'B) fill', 'C) bg-color', 'D) color-bg'], correct: 'A' },
                { question: '¬øQu√© propiedad alinea texto al centro?', options: ['A) text-align: center', 'B) center-text', 'C) align-center', 'D) text-center'], correct: 'A' },
                { question: '¬øQu√© propiedad controla el tama√±o del texto?', options: ['A) font-size', 'B) text-size', 'C) size', 'D) font'], correct: 'A' },
                { question: '¬øQu√© diferencia hay entre margin y padding?', options: ['A) margin externo / padding interno', 'B) margin interno / padding externo', 'C) no hay diferencia', 'D) ambos son externos'], correct: 'A' },
                { question: '¬øQu√© propiedad cambia el tipo de letra?', options: ['A) font-family', 'B) text-font', 'C) font-name', 'D) typeface'], correct: 'A' },
                { question: '¬øQu√© propiedad redondea las esquinas de un elemento?', options: ['A) border-radius', 'B) corner', 'C) round', 'D) curve'], correct: 'A' },
                { question: '¬øQu√© propiedad agrega una sombra a un elemento?', options: ['A) box-shadow', 'B) shadow', 'C) border-shadow', 'D) drop-shadow'], correct: 'A' },
                { question: '¬øQu√© propiedad controla la altura de l√≠nea de texto?', options: ['A) line-height', 'B) height-line', 'C) spacing', 'D) line-space'], correct: 'A' },

                // INTERMEDIO (11-20)
                { question: '¬øQu√© hace display:flex?', options: ['A) Mueve el texto', 'B) Crea una estructura flexible', 'C) Alinea im√°genes', 'D) Oculta elementos'], correct: 'B' },
                { question: '¬øQu√© propiedad distribuye espacio horizontal en Flexbox?', options: ['A) justify-content', 'B) align-items', 'C) space-between', 'D) flex-space'], correct: 'A' },
                { question: '¬øQu√© hace la propiedad transition?', options: ['A) A√±ade animaci√≥n suave', 'B) Cambia el color', 'C) Activa clic', 'D) Mueve elementos'], correct: 'A' },
                { question: '¬øQu√© propiedad controla el espaciado entre letras?', options: ['A) letter-spacing', 'B) word-spacing', 'C) text-space', 'D) char-spacing'], correct: 'A' },
                { question: '¬øQu√© propiedad controla la posici√≥n de un elemento?', options: ['A) position', 'B) placement', 'C) align', 'D) location'], correct: 'A' },
                { question: '¬øQu√© valor posiciona un elemento respecto al contenedor?', options: ['A) relative', 'B) absolute', 'C) static', 'D) fixed'], correct: 'B' },
                { question: '¬øQu√© valor coloca elementos uno al lado del otro?', options: ['A) inline-block', 'B) grid', 'C) float', 'D) flex'], correct: 'A' },
                { question: '¬øQu√© unidad mide el tama√±o relativo a la ra√≠z?', options: ['A) em', 'B) px', 'C) rem', 'D) vh'], correct: 'C' },
                { question: '¬øQu√© propiedad controla el orden de apilamiento?', options: ['A) z-index', 'B) stack', 'C) priority', 'D) layer'], correct: 'A' },
                { question: '¬øQu√© propiedad controla la opacidad de un elemento?', options: ['A) opacity', 'B) visibility', 'C) blur', 'D) transparent'], correct: 'A' },

                // AVANZADO (21-30)
                { question: '¬øQu√© define una animaci√≥n en CSS?', options: ['A) @animation', 'B) @keyframes', 'C) @frameset', 'D) @animate'], correct: 'B' },
                { question: '¬øQu√© propiedad inicia una animaci√≥n?', options: ['A) animate', 'B) animation-name', 'C) key-name', 'D) start-animation'], correct: 'B' },
                { question: '¬øQu√© propiedad define la duraci√≥n de una animaci√≥n?', options: ['A) time', 'B) animation-duration', 'C) duration', 'D) length'], correct: 'B' },
                { question: '¬øQu√© propiedad hace un contenedor con filas y columnas?', options: ['A) display:grid', 'B) display:block', 'C) display:flex', 'D) display:table'], correct: 'A' },
                { question: '¬øQu√© propiedad crea una cuadr√≠cula de 3 columnas?', options: ['A) grid-template-columns: repeat(3, 1fr)', 'B) grid-columns: 3', 'C) columns: grid(3)', 'D) grid: 3'], correct: 'A' },
                { question: '¬øQu√© propiedad define espaciado entre filas en Grid?', options: ['A) grid-row-gap', 'B) row-gap', 'C) gap', 'D) spacing'], correct: 'C' },
                { question: '¬øQu√© propiedad permite cambio suave de estilo?', options: ['A) transition', 'B) ease', 'C) effect', 'D) smooth'], correct: 'A' },
                { question: '¬øQu√© propiedad hace que un elemento sea fijo en pantalla?', options: ['A) position:fixed', 'B) display:block', 'C) float:right', 'D) sticky'], correct: 'A' },
                { question: '¬øQu√© propiedad alinea elementos verticalmente en Flexbox?', options: ['A) align-items', 'B) justify-content', 'C) align-self', 'D) vertical-align'], correct: 'A' },
                { question: '¬øQu√© propiedad define el color de un borde?', options: ['A) border-color', 'B) outline', 'C) frame', 'D) edge-color'], correct: 'A' }
            ],
            'Condicionales': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© palabra clave inicia una estructura condicional?', options: ['A) if', 'B) when', 'C) choose', 'D) select'], correct: 'A' },
                { question: '¬øQu√© palabra clave se usa cuando la condici√≥n no se cumple?', options: ['A) next', 'B) else', 'C) or', 'D) otherwise'], correct: 'B' },
                { question: '¬øQu√© operador se utiliza para comparar igualdad?', options: ['A) ==', 'B) =', 'C) ===', 'D) equals'], correct: 'A' },
                { question: '¬øQu√© operador l√≥gico representa el "Y" l√≥gico?', options: ['A) &&', 'B) ||', 'C) !=', 'D) AND'], correct: 'A' },
                { question: '¬øQu√© valor se considera falso sin compararlo?', options: ['A) 1', 'B) 0', 'C) "texto"', 'D) true'], correct: 'B' },
                { question: '¬øQu√© operador invierte el valor l√≥gico de una condici√≥n?', options: ['A) &&', 'B) ||', 'C) !', 'D) NOT'], correct: 'C' },
                { question: '¬øQu√© palabra eval√∫a m√°s de una condici√≥n?', options: ['A) else if / elif', 'B) case', 'C) for', 'D) switch'], correct: 'A' },
                { question: '¬øQu√© significa "evaluaci√≥n de cortocircuito"?', options: ['A) Se eval√∫a solo una vez', 'B) El resultado se detiene si ya se conoce', 'C) Ejecuta sin evaluar', 'D) Reinicia la evaluaci√≥n'], correct: 'B' },
                { question: '¬øQu√© operador ternario se usa en muchos lenguajes?', options: ['A) ?:', 'B) ??', 'C) %%', 'D) ::'], correct: 'A' },
                { question: '¬øQu√© pasa si ninguna condici√≥n se cumple?', options: ['A) El programa se detiene', 'B) Se ejecuta el bloque else', 'C) Se reinicia la condici√≥n', 'D) Error de sintaxis'], correct: 'B' },

                // INTERMEDIO (11-20)
                { question: '¬øQu√© estructura permite ejecutar distintos bloques seg√∫n condici√≥n?', options: ['A) if - else', 'B) while - for', 'C) do - while', 'D) loop'], correct: 'A' },
                { question: '¬øQu√© palabra se usa para encadenar condiciones adicionales?', options: ['A) elseif / elif', 'B) also', 'C) continue', 'D) then'], correct: 'A' },
                { question: '¬øQu√© estructura reemplaza varios if en casos conocidos?', options: ['A) switch', 'B) repeat', 'C) loop', 'D) match'], correct: 'A' },
                { question: '¬øQu√© hace este c√≥digo? if (x > 10 && x < 20)', options: ['A) Eval√∫a si x est√° entre 10 y 20', 'B) Eval√∫a si x es mayor que 20', 'C) Eval√∫a si x es menor que 10', 'D) Da error'], correct: 'A' },
                { question: 'if (false) {print("Hola")} else {print("Adi√≥s")} ¬øQu√© imprime?', options: ['A) Hola', 'B) Adi√≥s', 'C) Nada', 'D) Error'], correct: 'B' },
                { question: '¬øQu√© estructura es m√°s eficiente para rangos fijos?', options: ['A) switch', 'B) for', 'C) while', 'D) if anidado'], correct: 'A' },
                { question: '¬øQu√© palabra define una condici√≥n dentro de otra?', options: ['A) if anidado', 'B) condici√≥n doble', 'C) condici√≥n recursiva', 'D) if compuesto'], correct: 'A' },
                { question: '¬øQu√© operador l√≥gico representa el "O" l√≥gico?', options: ['A) &&', 'B) ||', 'C) !!', 'D) OR'], correct: 'B' },
                { question: '¬øCu√°l de los siguientes es un operador de comparaci√≥n?', options: ['A) >=', 'B) &&', 'C) or', 'D) ='], correct: 'A' },
                { question: '¬øQu√© tipo de estructura utiliza el operador ternario?', options: ['A) Condicional compacta', 'B) Bucle simple', 'C) Estructura repetitiva', 'D) Funci√≥n'], correct: 'A' },

                // AVANZADO (21-30)
                { question: 'x = 5; if x == 5: print("ok") else: print("no"). ¬øQu√© imprime?', options: ['A) ok', 'B) no', 'C) error', 'D) nada'], correct: 'A' },
                { question: 'En JavaScript, ¬øqu√© valor devuelve (5 > 2) && (3 < 1)?', options: ['A) true', 'B) false', 'C) undefined', 'D) null'], correct: 'B' },
                { question: '¬øQu√© ocurre si colocas un if dentro de un else?', options: ['A) Se eval√∫an ambos a la vez', 'B) Se crea una estructura anidada', 'C) Genera error de sintaxis', 'D) Solo ejecuta el else'], correct: 'B' },
                { question: '¬øQu√© tipo de valores pueden evaluarse en una condici√≥n?', options: ['A) Solo n√∫meros', 'B) Cualquier valor booleano', 'C) Solo texto', 'D) Solo variables'], correct: 'B' },
                { question: 'En el c√≥digo if (x != 10), ¬øqu√© significa "!="?', options: ['A) es igual', 'B) es diferente', 'C) es mayor', 'D) es menor'], correct: 'B' },
                { question: '¬øCu√°l es el resultado de if (false || true)?', options: ['A) true', 'B) false', 'C) error', 'D) undefined'], correct: 'A' },
                { question: '¬øQu√© significa este condicional?: if (!tienePermiso)', options: ['A) Si tiene permiso', 'B) Si no tiene permiso', 'C) Si permiso es undefined', 'D) Error de sintaxis'], correct: 'B' },
                { question: '¬øQu√© palabra clave finaliza un bloque if en Python?', options: ['A) endif', 'B) :', 'C) end', 'D) }'], correct: 'B' },
                { question: '¬øQu√© operador combina varias condiciones con prioridad?', options: ['A) ()', 'B) {}', 'C) []', 'D) <>'], correct: 'A' },
                { question: '¬øQu√© significa else if en un flujo de control?', options: ['A) Condici√≥n adicional', 'B) Condici√≥n final', 'C) Condici√≥n vac√≠a', 'D) Repetici√≥n'], correct: 'A' }
            ],
            'While': [
                // B√ÅSICO (1-10)
                { question: '¬øQu√© hace un bucle while?', options: ['A) Ejecuta c√≥digo solo una vez', 'B) Repite mientras la condici√≥n sea verdadera', 'C) Compara dos valores y termina', 'D) Cuenta hasta 10'], correct: 'B' },
                { question: '¬øQu√© tipo de valor eval√∫a la condici√≥n de un while?', options: ['A) Num√©rico', 'B) Booleano', 'C) Texto', 'D) Array'], correct: 'B' },
                { question: '¬øQu√© ocurre si la condici√≥n nunca cambia a false?', options: ['A) Se ejecuta una vez', 'B) Se crea un bucle infinito', 'C) Se fuerza un error', 'D) Se detiene solo'], correct: 'B' },
                { question: '¬øQu√© palabra clave detiene el bucle inmediatamente?', options: ['A) stop', 'B) exit', 'C) break', 'D) end'], correct: 'C' },
                { question: '¬øQu√© palabra clave salta a la siguiente iteraci√≥n?', options: ['A) continue', 'B) skip', 'C) next', 'D) pass'], correct: 'A' },
                { question: 'Si la condici√≥n es false al inicio, el while...', options: ['A) No se ejecuta', 'B) Se ejecuta una vez', 'C) Se ejecuta dos veces', 'D) Da error'], correct: 'A' },
                { question: '¬øQu√© se suele usar para contar iteraciones en un while?', options: ['A) Un acumulador', 'B) Un contador', 'C) Un comparador', 'D) Un √≠ndice'], correct: 'B' },
                { question: 'Para evitar bucles infinitos es importante...', options: ['A) No modificar variables', 'B) Modificar la variable de control apropiadamente', 'C) Usar siempre break', 'D) No usar condiciones'], correct: 'B' },
                { question: 'i=1; while(i<=3){print(i); i++} ¬øQu√© imprime?', options: ['A) 1 2 3', 'B) 0 1 2', 'C) 2 3 4', 'D) Error'], correct: 'A' },
                { question: '¬øQu√© instrucci√≥n para un men√∫ que se repite hasta "Salir"?', options: ['A) while (opcion != "Salir")', 'B) for (siempre)', 'C) switch (Salir)', 'D) if (Salir)'], correct: 'A' },

                // INTERMEDIO (11-20)
                { question: 'i=0; while(i<5){ i=i+2 } ¬øQu√© hace?', options: ['A) Itera 3 veces (0,2,4)', 'B) Itera 2 veces (0,2)', 'C) Nunca entra al bucle', 'D) Bucle infinito'], correct: 'A' },
                { question: '¬øCu√°l es el problema? while(i<10){ print(i) }', options: ['A) Falta incrementar i; puede ser infinito', 'B) No se puede imprimir en while', 'C) La condici√≥n debe ser i<=10', 'D) No hay problema'], correct: 'A' },
                { question: 'Patr√≥n correcto para sumar 1..n con while', options: ['A) i=1; suma=0; while(i<=n){ suma+=i; i++ }', 'B) i=0; suma=0; mientras(n){ suma+=n }', 'C) i=1; suma=0; while(i<n){ suma=i }', 'D) suma=0; while(true){ suma++ }'], correct: 'A' },
                { question: '¬øQu√© hace continue dentro de un while?', options: ['A) Termina el bucle', 'B) Salta el resto y pasa a la siguiente vuelta', 'C) Reinicia las variables', 'D) Pausa el bucle'], correct: 'B' },
                { question: 'Mejor forma de leer n√∫meros hasta ingresar 0', options: ['A) while(num != 0){ leer num; acumular }', 'B) while(true){ acumular }', 'C) for(num!=0){ leer num }', 'D) if(num==0){ leer }'], correct: 'A' },
                { question: 'i=0; while(i<3){ i++; } print(i) ¬øQu√© imprime?', options: ['A) 0', 'B) 2', 'C) 3', 'D) Error'], correct: 'C' },
                { question: 'Para validar entrada hasta que sea v√°lida se usa...', options: ['A) Un while con condici√≥n sobre la validez', 'B) Un for de 10 iteraciones', 'C) Un switch de opciones', 'D) Un if simple'], correct: 'A' },
                { question: '¬øQu√© ventaja tiene while sobre for?', options: ['A) Mejor cuando no se conoce el n√∫mero de repeticiones', 'B) Siempre es m√°s r√°pido', 'C) Permite anidar if', 'D) Es m√°s corto'], correct: 'A' },
                { question: 'i=1; while(i<=5){ if(i%2==0){print(i)}; i++ } ¬øQu√© imprime?', options: ['A) 1 3 5', 'B) 2 4', 'C) 2 3 4 5', 'D) Error'], correct: 'B' },
                { question: '¬øQu√© hace? while True: if intento==3: break', options: ['A) Nunca termina', 'B) Termina al tercer intento', 'C) Termina al primer intento', 'D) Error'], correct: 'B' },

                // AVANZADO (21-30)
                { question: 'Patr√≥n seguro para leer hasta palabra clave "salir"', options: ['A) while(palabra != "salir"){ leer palabra }', 'B) while("salir"){ leer palabra }', 'C) while(palabra == "salir"){ leer palabra }', 'D) for(palabra){ leer }'], correct: 'A' },
                { question: 'i=1; total=0; while(i<=4){ total+=i*i; i++ } print(total) ¬øImprime?', options: ['A) 10', 'B) 30', 'C) 20', 'D) 16'], correct: 'B' },
                { question: 'Para limitar un while a 100 iteraciones m√°ximo, usar√≠as...', options: ['A) Un contador de intentos y condici√≥n extra', 'B) Solo break sin condici√≥n', 'C) continue dentro de if', 'D) Un for'], correct: 'A' },
                { question: '¬øQu√© ocurre si pones break dentro de un if anidado en while?', options: ['A) Rompe todo el while', 'B) Solo salta a la siguiente iteraci√≥n', 'C) Reinicia el bucle', 'D) Error'], correct: 'A' },
                { question: 'Patr√≥n correcto para Fibonacci < 100', options: ['A) a=0;b=1; while(a<100){ print(a); a,b=b,a+b }', 'B) a=0; while(a<100){ a=a+a }', 'C) b=1; while(b<100){ print(b); b=b }', 'D) while(100){ print(a) }'], correct: 'A' },
                { question: '¬øQu√© hace? while(cond){ ...; if(error){ break } }', options: ['A) Finaliza el bucle si ocurre un error', 'B) Ignora los errores', 'C) Duplica las iteraciones', 'D) Contin√∫a siempre'], correct: 'A' },
                { question: 'Patr√≥n para "intentos de login" m√°x. 3', options: ['A) intentos=0; while(intentos<3 && !loginOk){ intentos++ }', 'B) while(loginOk){ pedir credenciales }', 'C) for(loginOk){ pedir credenciales }', 'D) if(intentos==3){ salir }'], correct: 'A' },
                { question: 'i=0; while(i<5){ i+=2; print(i) } ¬øQu√© imprime?', options: ['A) 1 2 3 4 5', 'B) 2 4', 'C) 2 4 6', 'D) 0 2 4'], correct: 'B' },
                { question: 'Para evitar consumir CPU en un while de espera activa...', options: ['A) Agregar una pausa (sleep)', 'B) Usar continue siempre', 'C) Incrementar dos veces el contador', 'D) Usar break'], correct: 'A' },
                { question: '¬øQu√© combinaci√≥n v√°lida para salir por m√∫ltiples condiciones?', options: ['A) Condici√≥n compuesta y/o break en casos especiales', 'B) Solo usar continue', 'C) Solo usar return', 'D) Solo usar exit'], correct: 'A' }
            ]
        };
    </script>
    <script>
        // Variables globales del dashboard de estudiante
        let currentUser = null;
        let authToken = null;
        let currentTheme = '';
        let currentQuestionIndex = 0;
        let selectedOption = null;
        let quizAnswered = false;
        let quizStartTime = null;

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function () {
            initializeStudentDashboard();
        });

        async function initializeStudentDashboard() {
            // Verificar autenticaci√≥n
            authToken = localStorage.getItem('retotech_token');
            const userData = localStorage.getItem('retotech_user');

            if (!authToken || !userData) {
                window.location.href = 'login.html';
                return;
            }

            currentUser = JSON.parse(userData);

            // Verificar que sea estudiante
            if (currentUser.role !== 'estudiante') {
                alert('Acceso denegado. Solo estudiantes pueden acceder aqu√≠.');
                window.location.href = 'login.html';
                return;
            }

            // Actualizar UI
            // Actualizar nombre de usuario en ambas ubicaciones
            document.getElementById('currentUserName').textContent = currentUser.username;
            document.getElementById('currentUserNameMobile').textContent = currentUser.username;

            // Actualizar curso en ambas ubicaciones
            document.getElementById('currentCourse').textContent = currentUser.curso;
            document.getElementById('currentCourseMobile').textContent = currentUser.curso;

            // Cargar estad√≠sticas del estudiante
            await loadStudentStats();
        }

        async function loadStudentStats() {
            try {
                const response = await fetch('/api/student/stats', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    updateScoreDisplay(stats);
                } else if (response.status === 401) {
                    // Token expirado
                    logout();
                } else {
                    console.error('Error cargando estad√≠sticas');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function updateScoreDisplay(stats) {
            const themes = ['HTML', 'CSS', 'Condicionales', 'While'];

            themes.forEach(theme => {
                // Filtrar todas las respuestas de este tema (todos los niveles)
                const themeStats = stats.filter(s => s.tema === theme);

                let totalCorrect = 0;
                let totalAnswered = 0;

                themeStats.forEach(stat => {
                    totalCorrect += parseInt(stat.respuestas_correctas) || 0;
                    totalAnswered += parseInt(stat.total_preguntas) || 0;
                });

                const scoreElement = document.getElementById(`score-${theme}`);
                if (scoreElement) {
                    // Mostrar progreso total del tema (de 30 preguntas posibles)
                    scoreElement.textContent = `Puntaje: ${totalCorrect}/30`;

                    // Agregar indicador visual de progreso
                    const percentage = (totalCorrect / 30) * 100;
                    let color = '#6b7280'; // gris por defecto

                    if (percentage >= 80) {
                        color = '#10b981'; // verde
                    } else if (percentage >= 60) {
                        color = '#f59e0b'; // amarillo
                    } else if (percentage > 0) {
                        color = '#ef4444'; // rojo
                    }

                    scoreElement.style.color = color;
                    scoreElement.style.fontWeight = 'bold';
                }
            });
        }
        // AGREGAR funci√≥n auxiliar para actualizar el progreso en tiempo real
        async function updateProgressAfterQuiz() {
            try {
                const response = await fetch('/api/student/stats', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    updateScoreDisplay(stats);
                }
            } catch (error) {
                console.error('Error actualizando progreso:', error);
            }
        }


        // Variable global para almacenar el nivel seleccionado
        let selectedLevel = null;
        let pendingTheme = null;

        // Funci√≥n modificada para mostrar el selector de nivel
        function startQuiz(theme) {
            pendingTheme = theme;
            document.getElementById('levelThemeName').textContent = theme;
            document.getElementById('levelSelectorOverlay').style.display = 'flex';
        }

        // Funci√≥n para seleccionar nivel y comenzar el quiz
        function selectLevel(level) {
            selectedLevel = level;
            document.getElementById('levelSelectorOverlay').style.display = 'none';

            // Iniciar el quiz con el tema y nivel seleccionados
            initializeQuiz(pendingTheme, selectedLevel);
        }

        // Funci√≥n para inicializar el quiz con el nivel seleccionado
        function initializeQuiz(theme, level) {
            currentTheme = theme;
            selectedLevel = level;
            currentQuestionIndex = 0;
            quizAnswered = false;
            quizStartTime = Date.now();

            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('statistics').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'block';

            // Actualizar tema en header
            document.getElementById('quiz-theme').textContent = `${theme} - ${level.charAt(0).toUpperCase() + level.slice(1)}`;

            displayQuestion();
        }

        // Funci√≥n para cancelar la selecci√≥n de nivel
        function cancelLevelSelection() {
            document.getElementById('levelSelectorOverlay').style.display = 'none';
            pendingTheme = null;
            selectedLevel = null;
        }

        // MODIFICAR la funci√≥n displayQuestion para usar el rango de preguntas seg√∫n el nivel
        function displayQuestion() {
            // Determinar rango de preguntas seg√∫n el nivel
            let startIndex, endIndex;
            switch (selectedLevel) {
                case 'basico':
                    startIndex = 0;
                    endIndex = 10;
                    break;
                case 'intermedio':
                    startIndex = 10;
                    endIndex = 20;
                    break;
                case 'avanzado':
                    startIndex = 20;
                    endIndex = 30;
                    break;
                default:
                    startIndex = 0;
                    endIndex = 10;
            }

            const levelQuestions = allQuestions[currentTheme].slice(startIndex, endIndex);
            const question = levelQuestions[currentQuestionIndex];
            const totalQuestions = levelQuestions.length;

            // Actualizar progreso
            const progressPercent = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            document.getElementById('progress-fill').style.width = progressPercent + '%';
            document.getElementById('progress-text').textContent = `Pregunta ${currentQuestionIndex + 1} de ${totalQuestions}`;
            document.getElementById('question-number').textContent = currentQuestionIndex + 1;

            document.getElementById('question-text').innerText = question.question;
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            quizAnswered = false;
            selectedOption = null;

            question.options.forEach((opt, i) => {
                const button = document.createElement('button');
                button.className = `option-button option-${opt.charAt(0).toLowerCase()}`;
                button.value = opt.charAt(0);

                const contentDiv = document.createElement('div');
                contentDiv.style.cssText = 'display: flex; align-items: flex-start; gap: 15px; width: 100%;';

                const letterDiv = document.createElement('div');
                letterDiv.style.cssText = 'background: rgba(255,255,255,0.3); border-radius: 50%; width: 35px; height: 35px; min-width: 35px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; font-weight: bold; flex-shrink: 0;';
                letterDiv.textContent = opt.charAt(0);

                const textDiv = document.createElement('div');
                textDiv.style.cssText = 'flex: 1; text-align: left; word-wrap: break-word; overflow-wrap: break-word; hyphens: auto; line-height: 1.4;';
                textDiv.textContent = opt.substring(3);

                contentDiv.appendChild(letterDiv);
                contentDiv.appendChild(textDiv);
                button.appendChild(contentDiv);

                button.onclick = () => selectOption(button, opt.charAt(0));
                optionsContainer.appendChild(button);
            });

            document.getElementById('message').innerHTML = '';
            document.getElementById('submit-btn').style.display = 'inline-block';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('submit-btn').disabled = false;
        }

        function selectOption(button, value) {
            if (quizAnswered) return;

            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('selected');
            });

            button.classList.add('selected');
            selectedOption = value;
        }

        // MODIFICAR la funci√≥n checkAnswer para incluir el nivel
        async function checkAnswer() {
            if (quizAnswered) return;

            if (!selectedOption) {
                alert('Por favor, selecciona una respuesta.');
                return;
            }

            quizAnswered = true;

            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.add('disabled');
            });

            // Determinar √≠ndice real de la pregunta seg√∫n el nivel
            let startIndex;
            switch (selectedLevel) {
                case 'basico':
                    startIndex = 0;
                    break;
                case 'intermedio':
                    startIndex = 10;
                    break;
                case 'avanzado':
                    startIndex = 20;
                    break;
                default:
                    startIndex = 0;
            }

            const realQuestionIndex = startIndex + currentQuestionIndex;
            const levelQuestions = allQuestions[currentTheme].slice(startIndex, startIndex + 10);
            const correct = levelQuestions[currentQuestionIndex].correct;
            const isCorrect = selectedOption === correct;
            const timeSpent = Math.floor((Date.now() - quizStartTime) / 1000);

            // Guardar respuesta en la base de datos CON EL NIVEL
            await saveAnswer(currentTheme, realQuestionIndex, selectedOption, isCorrect, timeSpent, selectedLevel);

            // Mostrar feedback
            showFeedback(isCorrect, correct);

            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'inline-block';
        }

        // MODIFICAR la funci√≥n saveAnswer para incluir el nivel (campo 'nivel')
        async function saveAnswer(tema, preguntaNumero, respuestaSeleccionada, esCorrecta, tiempoRespuesta, nivel) {
            try {
                const response = await fetch('/api/quiz/answer', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        tema,
                        pregunta_numero: preguntaNumero,
                        respuesta_seleccionada: respuestaSeleccionada,
                        es_correcta: esCorrecta,
                        tiempo_respuesta: tiempoRespuesta,
                        nivel: nivel  // NUEVO CAMPO
                    })
                });

                if (!response.ok) {
                    console.error('Error guardando respuesta');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function showFeedback(isCorrect, correctAnswer) {
            const messageDiv = document.getElementById('message');

            if (isCorrect) {
                messageDiv.innerHTML = `
                    <div class="feedback correct">
                        <img src="bien.jpg" class="avatar" alt="Correcto" />
                        <div class="text">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span class="emoji">üéâ</span>
                                <span class="correct-message">¬°Correcto!</span>
                            </div>
                        </div>
                    </div>
                `;
                messageDiv.className = 'quiz-message correct';
            } else {
                messageDiv.innerHTML = `
                    <div class="feedback incorrect">
                        <img src="mal.jpg" class="avatar" alt="Incorrecto" />
                        <div class="text">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <span class="emoji">üí•</span>
                                <span class="incorrect-message">¬°Incorrecto!</span>
                            </div>
                            <div><strong>La respuesta correcta es: ${correctAnswer}</strong></div>
                        </div>
                    </div>
                `;
                messageDiv.className = 'quiz-message incorrect';
            }
        }

        // MODIFICAR la funci√≥n nextQuestion para usar el rango correcto
        async function nextQuestion() {
            currentQuestionIndex++;

            // Verificar si complet√≥ las 10 preguntas del nivel
            if (currentQuestionIndex >= 10) {
                // Quiz completado - calcular resultado
                await showQuizResult();
            } else {
                displayQuestion();
            }
        }


        // MODIFICAR showQuizResult para actualizar el progreso
        async function showQuizResult() {
            try {
                // Obtener estad√≠sticas actualizadas para este tema y nivel
                const response = await fetch('/api/student/stats', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();

                    // Filtrar por tema y nivel actual
                    const currentLevelStats = stats.find(s =>
                        s.tema === currentTheme &&
                        s.nivel === selectedLevel
                    );

                    const correct = currentLevelStats ? currentLevelStats.respuestas_correctas : 0;
                    const total = currentLevelStats ? currentLevelStats.total_preguntas : 0;

                    // Mostrar modal de resultados
                    displayQuizResultModal(correct, total);

                    // Actualizar progreso en el men√∫ principal
                    updateScoreDisplay(stats);
                } else {
                    // Fallback si no se pueden obtener estad√≠sticas
                    displayQuizResultModal(0, 10);
                }

                // Recargar estad√≠sticas en segundo plano
                loadStudentStats();
            } catch (error) {
                console.error('Error:', error);
                displayQuizResultModal(0, 10);
                loadStudentStats();
            }
        }
        function displayQuizResultModal(correct, total) {
            const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
            const incorrect = total - correct;

            // Actualizar contenido del modal
            document.getElementById('result-theme').textContent = currentTheme;
            document.getElementById('score-percentage').textContent = percentage + '%';
            document.getElementById('correct-answers').textContent = correct;
            document.getElementById('incorrect-answers').textContent = incorrect;
            document.getElementById('total-answers').textContent = total;

            // Actualizar c√≠rculo de progreso
            const scoreCircle = document.getElementById('score-circle');
            const degrees = (percentage / 100) * 360;
            scoreCircle.style.background = `conic-gradient(#10b981 0deg ${degrees}deg, #e5e7eb ${degrees}deg 360deg)`;

            // Determinar performance y mensaje
            const performanceBadge = document.getElementById('performance-badge');
            const resultIcon = document.getElementById('result-icon');

            if (percentage >= 90) {
                performanceBadge.className = 'performance-badge excellent';
                performanceBadge.innerHTML = '<i class="fas fa-trophy"></i><span>¬°Excelente trabajo!</span>';
                resultIcon.innerHTML = '<i class="fas fa-trophy"></i>';
            } else if (percentage >= 80) {
                performanceBadge.className = 'performance-badge excellent';
                performanceBadge.innerHTML = '<i class="fas fa-star"></i><span>¬°Muy bien hecho!</span>';
                resultIcon.innerHTML = '<i class="fas fa-star"></i>';
            } else if (percentage >= 70) {
                performanceBadge.className = 'performance-badge good';
                performanceBadge.innerHTML = '<i class="fas fa-thumbs-up"></i><span>¬°Buen trabajo!</span>';
                resultIcon.innerHTML = '<i class="fas fa-thumbs-up"></i>';
            } else if (percentage >= 60) {
                performanceBadge.className = 'performance-badge average';
                performanceBadge.innerHTML = '<i class="fas fa-check"></i><span>Aprobado</span>';
                resultIcon.innerHTML = '<i class="fas fa-check"></i>';
            } else {
                performanceBadge.className = 'performance-badge needs-improvement';
                performanceBadge.innerHTML = '<i class="fas fa-redo"></i><span>Puedes mejorar</span>';
                resultIcon.innerHTML = '<i class="fas fa-redo"></i>';
            }

            // Mostrar el modal
            document.getElementById('quiz-result-overlay').style.display = 'flex';
        }

        function closeQuizResult() {
            document.getElementById('quiz-result-overlay').style.display = 'none';
        }

        // MODIFICAR retryQuiz para mantener el tema pero pedir nuevo nivel
        function retryQuiz() {
            // Cerrar modal de resultados
            closeQuizResult();

            // Mostrar selector de nivel nuevamente para el mismo tema
            const currentThemeName = currentTheme;
            currentTheme = null;
            selectedLevel = null;

            startQuiz(currentThemeName);
        }
        // MODIFICAR goBack para resetear el nivel
        function goBack() {
            // Cerrar modal de resultados si est√° abierto
            document.getElementById('quiz-result-overlay').style.display = 'none';

            // Resetear nivel seleccionado
            selectedLevel = null;
            pendingTheme = null;

            document.getElementById('quiz-section').style.display = 'none';
            showMainMenu();
        }

        function showMainMenu() {
            // Resetear cualquier quiz activo al volver al men√∫ principal
            currentTheme = null;
            currentQuestionIndex = 0;
            quizAnswered = false;
            selectedOption = null;

            document.getElementById('main-menu').style.display = 'flex';
            document.getElementById('statistics').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'none';
        }

        async function showStatistics() {
            // Cerrar modal de resultados si est√° abierto
            document.getElementById('quiz-result-overlay').style.display = 'none';

            // Verificar si hay un quiz activo
            const quizSection = document.getElementById('quiz-section');
            const isQuizActive = quizSection.style.display !== 'none';

            if (isQuizActive) {
                const confirmExit = confirm('¬øQuiere salir del test para ver las estad√≠sticas?\n\nSe perder√° el progreso actual del quiz.');
                if (!confirmExit) {
                    return;
                }
            }

            // Ocultar todas las secciones y mostrar estad√≠sticas
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('statistics').style.display = 'block';

            try {
                const response = await fetch('/api/student/stats', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const stats = await response.json();
                    displayStatistics(stats);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function displayStatistics(stats) {
            console.log('Estad√≠sticas recibidas:', stats);

            const themes = ['HTML', 'CSS', 'Condicionales', 'While'];
            const levels = ['basico', 'intermedio', 'avanzado'];

            let totalQuestions = 0;
            let totalCorrect = 0;

            // Procesar cada tema y nivel
            themes.forEach((theme, themeIndex) => {
                levels.forEach((level, levelIndex) => {
                    // Filtrar respuestas por tema y nivel
                    const levelStats = stats.filter(s =>
                        s.tema === theme &&
                        s.nivel === level
                    );

                    let correct = 0;
                    let total = 0;

                    if (levelStats.length > 0) {
                        correct = parseInt(levelStats[0].respuestas_correctas) || 0;
                        total = parseInt(levelStats[0].total_preguntas) || 0;
                    }

                    console.log(`${theme} - ${level}: ${correct}/${total}`);

                    totalQuestions += total;
                    totalCorrect += correct;

                    // Actualizar la UI para este nivel
                    const scoreElement = document.getElementById(`score-${theme}-${level}`);
                    const barElement = document.getElementById(`bar-${theme}-${level}`);

                    if (scoreElement && barElement) {
                        scoreElement.textContent = `${correct}/10`;

                        const percentage = total > 0 ? (correct / 10) * 100 : 0;

                        setTimeout(() => {
                            barElement.style.width = percentage + '%';

                            // Cambiar color seg√∫n el rendimiento
                            if (percentage >= 80) {
                                barElement.style.background = 'linear-gradient(90deg, #10b981, #34d399)';
                            } else if (percentage >= 60) {
                                barElement.style.background = 'linear-gradient(90deg, #f59e0b, #fbbf24)';
                            } else if (percentage > 0) {
                                barElement.style.background = 'linear-gradient(90deg, #ef4444, #f87171)';
                            } else {
                                barElement.style.background = 'linear-gradient(90deg, #9ca3af, #d1d5db)';
                            }
                        }, 200 * (themeIndex * 3 + levelIndex + 1));
                    }
                });
            });

            // Actualizar resumen general
            setTimeout(() => {
                animateValue('totalQuestions', 0, totalQuestions, 1000);
                const accuracy = totalQuestions > 0 ? Math.round((totalCorrect / totalQuestions) * 100) : 0;
                setTimeout(() => {
                    animateValue('overallAccuracy', 0, accuracy, 1000, '%');
                }, 500);
            }, 300);
        }
        function updateThemeProgress(theme, correct, total) {
            const scoreElement = document.getElementById(`score-${theme}`);
            const percentElement = document.getElementById(`percent-${theme}`);
            const progressCircle = document.getElementById(`progress-${theme}`);

            if (scoreElement && percentElement && progressCircle) {
                // Actualizar textos
                scoreElement.textContent = `${correct}/${Math.max(total, 30)}`;

                const percentage = total > 0 ? Math.round((correct / total) * 100) : 0;
                percentElement.textContent = percentage + '%';

                // Animar c√≠rculo de progreso
                const degrees = (percentage / 100) * 360;
                const color = getThemeColor(theme);

                setTimeout(() => {
                    progressCircle.style.background = `conic-gradient(${color} 0deg ${degrees}deg, #e5e7eb ${degrees}deg 360deg)`;
                }, 100);
            }
        }

        function getThemeColor(theme) {
            switch (theme) {
                case 'HTML': return '#e34c26';
                case 'CSS': return '#1572b6';
                case 'Condicionales': return '#f7df1e';
                case 'While': return '#8b5cf6';
                default: return '#10b981';
            }
        }

        function animateValue(id, start, end, duration, suffix = '') {
            const element = document.getElementById(id);
            const range = end - start;
            const startTime = performance.now();

            function updateValue(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);

                const easeOutQuart = 1 - Math.pow(1 - progress, 4);
                const current = Math.round(start + (range * easeOutQuart));

                element.textContent = current + suffix;

                if (progress < 1) {
                    requestAnimationFrame(updateValue);
                }
            }

            requestAnimationFrame(updateValue);
        }



        function logout() {
            localStorage.removeItem('retotech_token');
            localStorage.removeItem('retotech_user');
            window.location.href = 'login.html';
        }
    </script>
    <!-- Modal de Selecci√≥n de Nivel - Agregar ANTES del cierre de </body> -->
    <div class="level-selector-overlay" id="levelSelectorOverlay" style="display: none;">
        <div class="level-selector-modal">
            <div class="level-header">
                <h3>üéØ Selecciona el Nivel de Dificultad</h3>
                <p id="levelThemeName">HTML</p>
            </div>

            <div class="level-options">
                <div class="level-card" onclick="selectLevel('basico')">
                    <div class="level-icon">üìö</div>
                    <h4>B√°sico</h4>
                    <p>Preguntas 1-10</p>
                    <p class="level-description">Conceptos fundamentales y definiciones</p>
                </div>

                <div class="level-card" onclick="selectLevel('intermedio')">
                    <div class="level-icon">üìñ</div>
                    <h4>Intermedio</h4>
                    <p>Preguntas 11-20</p>
                    <p class="level-description">Aplicaci√≥n pr√°ctica de conceptos</p>
                </div>

                <div class="level-card" onclick="selectLevel('avanzado')">
                    <div class="level-icon">üéì</div>
                    <h4>Avanzado</h4>
                    <p>Preguntas 21-30</p>
                    <p class="level-description">Retos complejos y an√°lisis profundo</p>
                </div>
            </div>

            <button class="btn-cancel-level" onclick="cancelLevelSelection()">
                <i class="fas fa-times"></i> Cancelar
            </button>
        </div>
    </div>

    <style>
        /* Estilos para el modal de selecci√≥n de nivel */
        .level-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .level-selector-modal {
            background: white;
            border-radius: 25px;
            padding: 2rem;
            max-width: 800px;
            width: 95%;
            box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
        }

        .level-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .level-header h3 {
            color: #2d3748;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .level-header p {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            display: inline-block;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .level-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .level-card {
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            border: 3px solid transparent;
            border-radius: 20px;
            padding: 2rem 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .level-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-color: #667eea;
        }

        .level-card:hover::before {
            transform: scaleX(1);
        }

        .level-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .level-card h4 {
            color: #2d3748;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .level-card p {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .level-description {
            color: #94a3b8;
            font-size: 0.85rem;
            font-style: italic;
        }

        .btn-cancel-level {
            width: 100%;
            background: linear-gradient(135deg, #6b7280, #4b5563);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-cancel-level:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .level-selector-modal {
                padding: 1.5rem;
            }

            .level-options {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .level-card {
                padding: 1.5rem 1rem;
            }

            .level-icon {
                font-size: 2.5rem;
            }

            .level-header h3 {
                font-size: 1.4rem;
            }
        }

        @media (max-width: 480px) {
            .level-selector-modal {
                padding: 1rem;
                width: 98%;
            }

            .level-card {
                padding: 1.2rem 0.8rem;
            }

            .level-icon {
                font-size: 2rem;
            }

            .level-card h4 {
                font-size: 1.2rem;
            }
        }
    </style>
</body>

</html>